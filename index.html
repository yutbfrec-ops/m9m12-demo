<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>M9/M12 èƒ½åŠ›ç›¤é» Beta | Build: UIA-BANKB v1.0.0 2025-12-29</title>

  <style>
    :root{
      --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto,
              "Noto Sans TC","PingFang TC","Microsoft JhengHei", Arial, sans-serif;

      --bg: #f6f8fb;
      --ink:#0f172a;
      --muted:#64748b;
      --card:#ffffff;
      --line: rgba(15,23,42,.10);

      --brand:#2f6fed;
      --brand-2:#1f55c8;

      --chip:#ffffff;
      --chip-line: rgba(15,23,42,.16);

      --star:#f59e0b;
      --star-off: rgba(15,23,42,.16);

      /* æ‰‹æ©Ÿæ¡†ï¼ˆç°è‰²ï¼‰ */
      --frame-1:#5f6773;
      --frame-2:#3f4651;
      --frame-border: rgba(255,255,255,.18);
      --frame-shadow: 0 18px 60px rgba(2,8,23,.26);

      --radius: 28px;
      --screen-radius: 22px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--ink);
      background:
        radial-gradient(1100px 650px at 22% -10%, rgba(47,111,237,.12), transparent 55%),
        radial-gradient(900px 520px at 95% 25%, rgba(245,158,11,.10), transparent 55%),
        var(--bg);
      display:flex;
      align-items:center;
      justify-content:center;

      /* æ¡Œæ©Ÿä¿ç•™ç©ºé–“ï¼ˆæ‰‹æ©Ÿæœƒè¦†è“‹ï¼‰ */
      padding: 24px;
    }

    /* æ‰‹æ©Ÿæ¡†å®¹å™¨ï¼šå–®å±¤ç°æ¡†ï¼ˆé¿å…ä½ ä¹‹å‰é»‘+ç°åŒæ™‚å­˜åœ¨ï¼‰ */
    .phone{
      width: min(430px, 92vw);
      background: linear-gradient(180deg, var(--frame-1), var(--frame-2));
      border: 1px solid var(--frame-border);
      border-radius: 34px;
      padding: 14px;
      box-shadow: var(--frame-shadow);
    }

    /* å…§éƒ¨ã€Œè¢å¹•ã€ */
    .screen{
      background: var(--card);
      border-radius: var(--screen-radius);
      overflow: hidden;
      position: relative;
      min-height: 780px; /* æ¡Œæ©Ÿçœ‹åˆ°æ¯”è¼ƒåƒ mockup */
    }

    /* æ¨¡æ“¬ä¸Šæ–¹ç‹€æ…‹åˆ—ï¼ˆä½ èªªå…ˆä¸ç®¡æ™‚é–“ï¼Œä¿ç•™å³å¯ï¼‰ */
    .statusbar{
      height: 52px;
      padding: 10px 14px 0 14px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      color: rgba(15,23,42,.68);
      font-size: 13px;
    }
    .status-icons{
      display:flex; gap:8px; align-items:center;
      font-size: 12px;
    }
    .pill{
      width: 110px; height: 5px;
      background: rgba(15,23,42,.16);
      border-radius: 99px;
      margin: 6px auto 0;
    }

    .app{
      padding: 18px 18px 14px;
    }

    .topnav{
      display:flex;
      align-items:center;
      justify-content:space-between;
      color: var(--muted);
      font-size: 14px;
      margin-bottom: 8px;
    }
    .topnav .left{
      display:flex; align-items:center; gap:8px;
      cursor:pointer;
      user-select:none;
      color:#415a8a;
      font-weight: 650;
    }
    .topnav .mid{
      font-weight: 650;
      letter-spacing:.5px;
      color:#64748b;
    }

    h1{
      font-size: 34px;
      line-height: 1.15;
      margin: 14px 0 10px;
      letter-spacing:.2px;
    }
    .sub{
      color: var(--muted);
      font-size: 14.5px;
      line-height: 1.6;
      margin-bottom: 14px;
    }

    .input{
      width:100%;
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px 14px;
      font-size: 16px;
      outline:none;
      background:#fff;
    }
    .input:focus{
      border-color: rgba(47,111,237,.45);
      box-shadow: 0 0 0 4px rgba(47,111,237,.12);
    }

    .chips{ display:flex; flex-wrap:wrap; gap:10px; margin: 10px 0 2px; }
    .chip{
      border: 1px solid var(--chip-line);
      background: var(--chip);
      border-radius: 999px;
      padding: 10px 14px;
      font-size: 15px;
      color:#1f2a44;
      cursor:pointer;
      user-select:none;
    }
    .chip.active{
      border-color: rgba(47,111,237,.55);
      background: rgba(47,111,237,.10);
      box-shadow: inset 0 0 0 1px rgba(47,111,237,.15);
      font-weight: 650;
      color:#1f4fb8;
    }

    .rowlink{
      margin-top: 12px;
      display:flex; align-items:center; justify-content:space-between;
      padding: 12px 4px;
      color:#415a8a;
      font-weight: 700;
      cursor:pointer;
      user-select:none;
    }

    .hero{
      margin: 10px 0 14px;
      height: 150px;
      border-radius: 18px;
      background:
        radial-gradient(120px 120px at 35% 40%, rgba(47,111,237,.18), transparent 55%),
        radial-gradient(160px 160px at 70% 65%, rgba(47,111,237,.12), transparent 55%),
        linear-gradient(180deg, rgba(2,8,23,.02), rgba(2,8,23,0));
      border: 1px solid rgba(15,23,42,.06);
      position: relative;
      overflow:hidden;
    }
    .hero:after{
      content:"";
      position:absolute;
      right: 16px; top: 18px;
      width: 44px; height: 44px;
      border-radius: 999px;
      background: rgba(47,111,237,.14);
      border: 1px solid rgba(47,111,237,.18);
    }
    .hero:before{
      content:"+";
      position:absolute;
      right: 28px; top: 18px;
      font-size: 22px;
      color:#1f55c8;
      font-weight: 800;
      line-height: 44px;
    }
    .hero .moon{
      position:absolute;
      left: 18px; bottom: 18px;
      width: 44px; height: 44px;
      border-radius: 999px;
      background: rgba(245,158,11,.18);
      border: 1px solid rgba(245,158,11,.24);
      display:flex; align-items:center; justify-content:center;
      font-weight: 900;
      color:#b45309;
    }
    .hero .note{
      position:absolute;
      left: 72px; bottom: 18px;
      width: 160px; height: 60px;
      border-radius: 14px;
      background: rgba(255,255,255,.8);
      border: 1px solid rgba(15,23,42,.08);
      box-shadow: 0 10px 30px rgba(2,8,23,.06);
    }
    .hero .note:after{
      content:"";
      position:absolute; left: 16px; top: 18px;
      width: 120px; height: 6px;
      border-radius: 99px;
      background: rgba(15,23,42,.14);
      box-shadow: 0 14px 0 rgba(15,23,42,.10);
    }

    .btn{
      width:100%;
      border:0;
      border-radius: 16px;
      padding: 14px 16px;
      font-size: 18px;
      font-weight: 800;
      color:#fff;
      background: linear-gradient(180deg, var(--brand), var(--brand-2));
      box-shadow: 0 12px 30px rgba(47,111,237,.25);
      cursor:pointer;
      user-select:none;
    }
    .btn.secondary{
      margin-top:10px;
      background: #eef3ff;
      color:#1f3f8f;
      box-shadow:none;
      border: 1px solid rgba(47,111,237,.20);
      font-weight: 800;
    }
    .btn.ghost{
      margin-top:10px;
      background: #ffffff;
      color:#334155;
      box-shadow:none;
      border: 1px solid rgba(15,23,42,.12);
      font-weight: 800;
    }

    .hint{
      margin-top: 10px;
      font-size: 12.5px;
      color: rgba(15,23,42,.55);
      line-height: 1.45;
    }

    .buildbar{
      padding: 10px 18px 14px;
      font-size: 12px;
      color: rgba(15,23,42,.55);
      display:flex;
      justify-content:space-between;
      gap:12px;
      border-top: 1px solid rgba(15,23,42,.06);
      background: linear-gradient(180deg, rgba(2,8,23,0), rgba(2,8,23,.02));
    }
    .buildbar .leftnote{ flex:1; }
    .buildbar .build{
      white-space:nowrap;
      font-weight: 700;
      color: rgba(15,23,42,.62);
    }

    /* å¡ç‰‡æ¨£å¼ */
    .card{
      border: 1px solid rgba(15,23,42,.10);
      border-radius: 18px;
      background: #fff;
      padding: 16px;
      box-shadow: 0 10px 24px rgba(2,8,23,.05);
    }
    .card + .card{ margin-top: 12px; }

    .bigscore{
      display:flex; align-items:flex-end; gap:12px;
      margin-bottom: 10px;
    }
    .bigscore .n{
      font-size: 58px; font-weight: 900; line-height: .95;
      color:#0b1220;
    }
    .bigscore .t{
      font-weight: 900; font-size: 18px; color:#1f3f8f;
    }
    .stars{ display:flex; gap:4px; }
    .star{ font-size: 16px; line-height: 1; }
    .star.on{ color: var(--star); }
    .star.off{ color: var(--star-off); }

    .kv{
      display:flex; justify-content:space-between; align-items:center;
      padding: 10px 0;
      border-top: 1px solid rgba(15,23,42,.08);
    }
    .kv:first-of-type{ border-top:0; }
    .kv .k{ color:#334155; font-weight: 750; }
    .kv .v{ color:#0f172a; font-weight: 850; }

    .section-title{
      margin: 14px 0 10px;
      font-size: 18px;
      font-weight: 900;
      color:#334155;
    }

    .insight{
      border: 1px solid rgba(15,23,42,.10);
      border-radius: 16px;
      padding: 14px;
      background: #fff;
    }
    .insight + .insight{ margin-top: 10px; }
    .insight .tag{
      font-weight: 900;
      color:#475569;
      margin-bottom: 6px;
    }
    .insight .text{
      color:#334155;
      line-height: 1.55;
      font-size: 14.5px;
    }

    /* é€²éšè¨­å®šï¼ˆå½ˆçª—ï¼‰ */
    .modalback{
      position:absolute; inset:0;
      background: rgba(2,8,23,.35);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding: 12px;
    }
    .modal{
      width:100%;
      border-radius: 18px;
      background:#fff;
      border: 1px solid rgba(15,23,42,.10);
      box-shadow: 0 20px 60px rgba(2,8,23,.25);
      padding: 14px;
    }
    .modal h3{
      margin: 6px 2px 10px;
      font-size: 16px;
      font-weight: 950;
      color:#0f172a;
    }
    .seg{
      display:flex; gap:10px; margin: 10px 0 14px;
    }
    .seg button{
      flex:1;
      border-radius: 999px;
      padding: 10px 12px;
      border: 1px solid rgba(15,23,42,.14);
      background:#fff;
      font-weight: 900;
      color:#334155;
      cursor:pointer;
    }
    .seg button.active{
      border-color: rgba(47,111,237,.55);
      background: rgba(47,111,237,.10);
      color:#1f4fb8;
      box-shadow: inset 0 0 0 1px rgba(47,111,237,.15);
    }
    .modal .actions{
      display:flex; gap:10px; margin-top: 10px;
    }
    .modal .actions button{
      flex:1;
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 950;
      cursor:pointer;
      border: 1px solid rgba(15,23,42,.12);
      background:#fff;
      color:#334155;
    }
    .modal .actions button.primary{
      border:0;
      background: linear-gradient(180deg, var(--brand), var(--brand-2));
      color:#fff;
    }

    /* æ‰‹æ©Ÿæ»¿ç‰ˆè²¼è¿‘ï¼šé‡é»åœ¨é€™æ®µ */
    @media (max-width: 520px){
      body{
        padding: 0; /* ç§»é™¤æ¡Œæ©Ÿç•™ç™½ */
        background: var(--bg); /* æ‰‹æ©Ÿç°¡åŒ–èƒŒæ™¯ï¼Œé¿å…è¦–è¦ºåƒã€Œå¤–æ¡†ç•™ç™½ã€ */
      }
      .phone{
        width: calc(100vw - 12px); /* å·¦å³å„ 6pxï¼Œæ¥è¿‘æ»¿ç‰ˆ */
        margin: 6px;
        border-radius: 30px;
        padding: 12px;
      }
      .screen{
        min-height: calc(100vh - 12px - 24px); /* è®“ç•«é¢æ›´æ¥è¿‘æ»¿ç‰ˆé«˜åº¦ */
      }
    }
  </style>
</head>

<body>
  <div class="phone">
    <div class="screen" id="screen">

      <div class="statusbar">
        <div id="fakeTime">08:07</div>
        <div class="status-icons">â–®â–®â–® âš¡ ğŸ”‹</div>
      </div>
      <div class="pill"></div>

      <div class="app" id="app"></div>

      <div class="buildbar">
        <div class="leftnote" id="leftNote">æç¤ºï¼šé€™æ˜¯ Beta Demoï¼ˆç„¡å¾Œç«¯ï¼‰ã€‚è³‡æ–™åªå­˜åœ¨ä½ æœ¬æ©Ÿç€è¦½å™¨ï¼ˆå¯æ¸…é™¤ï¼‰ã€‚æ¯å€‹ä¸»é¡Œæœƒå„è‡ªä¿å­˜è‰ç¨¿ï¼ˆäº’ä¸è¦†è“‹ï¼‰ã€‚</div>
        <div class="build" id="buildText"></div>
      </div>

      <!-- Advanced Settings Modal -->
      <div class="modalback" id="modalBack">
        <div class="modal">
          <h3>é€²éšè¨­å®š</h3>

          <div style="color:#64748b;font-size:13px;line-height:1.5;">
            ä½ å¯ä»¥å…ˆç”¨ <b>M9</b>ï¼ˆè¼ƒå¿«ï¼‰åšå°æµï¼Œå†ç”¨ <b>M12</b>ï¼ˆè¼ƒæ·±ï¼‰åšä»˜è²»å ±å‘Šï¼é¡§å•äº¤ä»˜ã€‚
          </div>

          <div class="section-title" style="margin-top:12px;">æ¨¡å¼åˆ‡æ›ï¼ˆM9 / M12ï¼‰</div>
          <div class="seg">
            <button id="btnM9" type="button">M9ï¼ˆå¿«é€Ÿï¼‰</button>
            <button id="btnM12" type="button">M12ï¼ˆæ·±åº¦ï¼‰</button>
          </div>

          <div class="actions">
            <button type="button" id="btnCancel">å–æ¶ˆ</button>
            <button type="button" class="primary" id="btnSave">å„²å­˜</button>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
/* =========================================================
   åªæ”¹é€™ä¸€è¡Œï¼šBuild é•·ç‰ˆï¼ˆå®šæ¡ˆæ ¼å¼ï¼‰
   ========================================================= */
const BUILD = "Build: UIA-BANKB v1.0.0 2025-12-29";

/* =========================================================
   Demo è¨­å®šï¼šæ¨¡å¼ï¼ˆM9/M12ï¼‰å­˜æœ¬æ©Ÿ
   ========================================================= */
const LS_MODE_KEY = "m9m12_mode";
const LS_TOPIC_KEY = "m9m12_topic";
const LS_DRAFT_PREFIX = "m9m12_draft"; // æœƒå†åŠ ä¸Š mode+topic åšéš”é›¢

const BANK = {
  // æ¨¡å¼è¶Šæ·±ï¼Œé¡Œæ•¸è¶Šå¤šã€æ´å¯Ÿè¶Šé•·ï¼ˆUI é‚è¼¯ä¸è®Šï¼‰
  M9: {
    name: "M9ï¼ˆå¿«é€Ÿï¼‰",
    questionCount: 6,
    insightStyle: "short"
  },
  M12: {
    name: "M12ï¼ˆæ·±åº¦ï¼‰",
    questionCount: 10,
    insightStyle: "long"
  }
};

const TOPICS = [
  { id:"æºé€šå”ä½œ", label:"æºé€šå”ä½œ" },
  { id:"åŸ·è¡Œæ¨é€²", label:"åŸ·è¡Œæ¨é€²" },
  { id:"å•é¡Œè§£æ±º", label:"å•é¡Œè§£æ±º" },
  { id:"é ˜å°å¸¶äºº", label:"é ˜å°å¸¶äºº" }
];

const DIMENSIONS = [
  "å”ä½œæ¨é€²","æºé€šæ¸…æ™°","å…±è­˜å°é½Š","æå•æ¾„æ¸…","å½±éŸ¿åŠ›","è¡çªè™•ç†","å›é¥‹å¸æ”¶","å”ä½œè¦å‰‡"
];

/* ===== App State ===== */
let state = {
  page: "home",            // home | quiz | done | summary
  mode: loadMode(),
  topic: loadTopic(),
  answers: [],
  idx: 0
};

init();

/* =========================================================
   UI Render
   ========================================================= */
function init(){
  // Build é¡¯ç¤º + title
  document.getElementById("buildText").textContent = BUILD;
  document.title = `M9/M12 èƒ½åŠ›ç›¤é» Beta | ${BUILD}`;

  // fake timeï¼ˆä¿ç•™å³å¯ï¼‰
  document.getElementById("fakeTime").textContent = getHHMM();

  // Modal events
  hookModal();

  // Load draft if exists
  loadDraftIfAny();

  // Render
  render();
}

function render(){
  const app = document.getElementById("app");
  app.innerHTML = "";

  if(state.page === "home") return renderHome(app);
  if(state.page === "quiz") return renderQuiz(app);
  if(state.page === "done") return renderDone(app);
  if(state.page === "summary") return renderSummary(app);
}

function renderHome(root){
  const topnav = el("div","topnav",
    el("div","left",""),
    el("div","mid",""),
    el("div","","")
  );
  topnav.querySelector(".mid").textContent = "";
  root.appendChild(topnav);

  root.appendChild(el("h1","",`ä½ æƒ³ç›¤é»å“ªå€‹\nè·å ´èƒ½åŠ›ï¼Ÿ`));

  const sub = el("div","sub",
    `åƒåšã€Œæ—…éŠæ›¸ã€ä¸€æ¨£ï¼Œ3â€“5 åˆ†é˜å®Œæˆç›¤é»ï¼Œç«‹å³æ‹¿åˆ°æ˜Ÿç­‰èˆ‡å»ºè­°ã€‚` +
    `\nç›®å‰æ¨¡å¼ï¼š` + `<b>${BANK[state.mode].name}</b>`
  );
  sub.innerHTML = sub.innerHTML.replaceAll("\n","<br>");
  root.appendChild(sub);

  const input = el("input","input","");
  input.placeholder = "ä¾‹å¦‚ï¼šæºé€šå”ä½œ / å•é¡Œè§£æ±º";
  input.value = state.topic || "";
  input.addEventListener("input", (e)=>{
    state.topic = e.target.value.trim();
    saveTopic(state.topic);
  });
  root.appendChild(input);

  const chips = el("div","chips","");
  TOPICS.forEach(t=>{
    const c = el("div","chip",t.label);
    if(state.topic === t.id) c.classList.add("active");
    c.addEventListener("click", ()=>{
      state.topic = t.id;
      saveTopic(state.topic);
      input.value = state.topic;
      [...chips.children].forEach(x=>x.classList.remove("active"));
      c.classList.add("active");
    });
    chips.appendChild(c);
  });
  root.appendChild(chips);

  const link = el("div","rowlink",`é€²éšè¨­å®š <span style="color:#94a3b8;font-weight:900;">â€º</span>`);
  link.addEventListener("click", openModal);
  root.appendChild(link);

  root.appendChild(el("div","hero",
    `<div class="moon">â—</div><div class="note"></div>`
  ));

  const btn = el("button","btn","ä¸‹ä¸€æ­¥");
  btn.addEventListener("click", ()=>{
    if(!state.topic){
      shake(input);
      return;
    }
    // é‡æ–°åˆ‡é¡Œç›®æ™‚ï¼Œå…ˆè¼‰å…¥è©² topic draft
    loadDraftIfAny(true);
    startQuiz();
  });
  root.appendChild(btn);

  // ä¸‹æ–¹æç¤ºæ–‡å­—äº¤çµ¦ buildbar çš„ leftNoteï¼ˆä¸ç”¨åœ¨é€™è£¡é‡è¤‡ï¼‰
}

function renderQuiz(root){
  const top = el("div","topnav",
    el("div","left","â€¹ è¿”å›"),
    el("div","mid","ç›¤é»"),
    el("div","","")
  );
  top.querySelector(".left").addEventListener("click", ()=>{
    // å›é¦–é ä¸æ¸…è‰ç¨¿
    state.page = "home";
    render();
  });
  root.appendChild(top);

  const title = el("h1","",`ä¸»é¡Œï¼š${state.topic}`);
  title.style.fontSize = "28px";
  root.appendChild(title);

  root.appendChild(el("div","sub",
    `æ¨¡å¼ï¼š<b>${BANK[state.mode].name}</b>ã€€|ã€€å·²å›ç­” <b>${state.idx+1}/${state.answers.length}</b>`
  ));

  const card = el("div","card","");
  card.appendChild(el("div","",`ç¬¬ <b>${state.idx+1}</b> é¡Œ`));
  const q = el("div","",`åœ¨ã€Œ${state.topic}ã€æƒ…å¢ƒä¸‹ï¼Œæˆ‘é€šå¸¸èƒ½åšåˆ°ï¼š`);
  q.style.marginTop = "8px";
  q.style.fontWeight = "900";
  card.appendChild(q);

  const dim = DIMENSIONS[state.idx % DIMENSIONS.length];
  const hint = el("div","",`ï¼ˆè©•ä¼°é¢å‘ï¼š${dim}ï¼‰`);
  hint.style.marginTop = "6px";
  hint.style.color = "#64748b";
  hint.style.fontSize = "13px";
  card.appendChild(hint);

  // 1~5 é¸æ“‡
  const chips = el("div","chips","");
  const current = state.answers[state.idx] ?? 0;
  [1,2,3,4,5].forEach(n=>{
    const c = el("div","chip", `${n} åˆ†`);
    if(current === n) c.classList.add("active");
    c.addEventListener("click", ()=>{
      state.answers[state.idx] = n;
      saveDraft();
      render();
    });
    chips.appendChild(c);
  });
  card.appendChild(chips);

  // ä¸‹ä¸€é¡Œ
  const next = el("button","btn", state.idx === state.answers.length-1 ? "å®Œæˆ" : "ä¸‹ä¸€é¡Œ");
  next.style.marginTop = "12px";
  next.addEventListener("click", ()=>{
    if(!state.answers[state.idx]){
      shake(card);
      return;
    }
    if(state.idx < state.answers.length-1){
      state.idx += 1;
      saveDraft();
      render();
    }else{
      state.page = "done";
      saveDraft();
      render();
    }
  });

  const prev = el("button","btn secondary","ä¸Šä¸€é¡Œ");
  prev.addEventListener("click", ()=>{
    if(state.idx > 0){
      state.idx -= 1;
      saveDraft();
      render();
    }else{
      state.page = "home";
      render();
    }
  });

  root.appendChild(card);
  root.appendChild(next);
  root.appendChild(prev);
}

function renderDone(root){
  const top = el("div","topnav",
    el("div","left","â€¹ è¿”å›"),
    el("div","mid","å®Œæˆ"),
    el("div","","")
  );
  top.querySelector(".left").addEventListener("click", ()=>{
    state.page = "quiz";
    render();
  });
  root.appendChild(top);

  root.appendChild(el("h1","",`å·²å®Œæˆå›ç­”ï¼Œ\nè¦ç”Ÿæˆçµæœå—ï¼Ÿ`));
  const sub = el("div","sub",
    `ä½ å¯ä»¥å›åˆ°ä¸Šä¸€é¡Œä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”Ÿæˆæ˜Ÿç­‰èˆ‡æ´å¯Ÿã€‚<br>` +
    `ä¸»é¡Œï¼š<b>${state.topic}</b>ã€€|ã€€æ¨¡å¼ï¼š<b>${BANK[state.mode].name}</b>`
  );
  root.appendChild(sub);

  const card = el("div","card","");
  card.innerHTML = `
    <div style="display:flex;justify-content:space-between;gap:12px;">
      <div>
        <div style="color:#64748b;font-weight:800;">å·²å›ç­”</div>
        <div style="font-size:18px;font-weight:950;margin-top:2px;">${state.answers.filter(Boolean).length}/${state.answers.length}</div>
      </div>
      <div style="text-align:right;">
        <div style="color:#64748b;font-weight:800;">ä¸»é¡Œ</div>
        <div style="font-size:18px;font-weight:950;margin-top:2px;">${state.topic}</div>
      </div>
    </div>
    <div style="margin-top:10px;color:#64748b;font-size:13px;line-height:1.5;">
      ç”Ÿæˆåˆ†å…©æ­¥ï¼šå…ˆè¨ˆç®—æ˜Ÿç­‰ â†’ å†ç”Ÿæˆæ´å¯Ÿï¼ˆæ›´åƒå•†æ¥­å·¥å…·çš„å¯ä¿¡æµç¨‹ï¼‰ã€‚
    </div>
  `;
  root.appendChild(card);

  const gen = el("button","btn","ç”Ÿæˆæˆ‘çš„çµæœ");
  gen.addEventListener("click", ()=>{
    state.page = "summary";
    render();
  });
  root.appendChild(gen);

  const restart = el("button","btn secondary","é‡æ–°é–‹å§‹");
  restart.addEventListener("click", ()=>{
    clearDraft();
    state.answers = [];
    state.idx = 0;
    state.page = "home";
    render();
  });
  root.appendChild(restart);
}

function renderSummary(root){
  const top = el("div","topnav",
    el("div","left","â€¹ å›é¦–é "),
    el("div","mid","çµæœæ‘˜è¦"),
    el("div","","")
  );
  top.querySelector(".left").addEventListener("click", ()=>{
    state.page = "home";
    render();
  });
  root.appendChild(top);

  root.appendChild(el("h1","",`ä½ çš„çµæœæ‘˜è¦`));
  root.appendChild(el("div","sub",`å…ˆçœ‹é‡é»å¡ç‰‡ï¼Œå†æ±ºå®šè¦ä¸è¦å±•é–‹å®Œæ•´ç‰ˆã€‚`));

  const score = calcScore();
  const overallStars = toStars(score.overall);

  const card = el("div","card","");
  const gradeText = score.overall >= 4 ? "é«˜å¯ç”¨ï½œå¯ç›´æ¥è½åœ°"
                  : score.overall >= 3 ? "ä¸­ç­‰å¯ç”¨ï½œéœ€å»ºç«‹ä¸€è‡´æ–¹æ³•"
                  : "é¢¨éšªåé«˜ï½œå…ˆä¿®æ­£é—œéµç¿’æ…£";
  card.appendChild(el("div","bigscore",`
    <div class="n">${Math.round(score.overall)}</div>
    <div>
      <div class="t">${gradeText}</div>
      <div style="margin-top:6px;" class="stars">${renderStars(overallStars)}</div>
      <div style="margin-top:6px;color:#64748b;font-size:13px;">
        å¯ä¿¡åº¦ï¼š95%ï¼ˆå·²å›ç­” ${score.answered}/${score.total}ï¼‰
      </div>
    </div>
  `));

  // ç¶­åº¦æ˜Ÿç­‰ï¼ˆå›ºå®š 8 æ¢ï¼Œæ–¹ä¾¿å±•ç¤ºï¼‰
  score.dims.forEach(d=>{
    const row = el("div","kv","");
    row.innerHTML = `
      <div class="k">${d.name}</div>
      <div class="v">
        <span class="stars" style="justify-content:flex-end;display:flex;">${renderStars(d.stars)}</span>
      </div>
    `;
    card.appendChild(row);
  });

  root.appendChild(card);

  // æ´å¯Ÿï¼ˆä¾æ¨¡å¼é•·çŸ­ï¼‰
  root.appendChild(el("div","section-title","ä¸‰å€‹æ´å¯Ÿ"));
  const insights = buildInsights(score, BANK[state.mode].insightStyle);

  insights.forEach(it=>{
    const box = el("div","insight","");
    box.innerHTML = `
      <div class="tag">${it.tag}</div>
      <div class="text">${it.text}</div>
    `;
    root.appendChild(box);
  });

  // ç«‹å³è¡Œå‹•
  const action = el("div","card","");
  action.innerHTML = `
    <div style="color:#475569;font-weight:950;">ç«‹å³è¡Œå‹•ï¼ˆä»Šå¤©å°±èƒ½åšï¼‰</div>
    <div style="margin-top:10px;font-size:20px;line-height:1.35;font-weight:950;">
      ä¸‹æ¬¡äº¤è¾¦å‰å…ˆå¯« 1 è¡Œã€Œç›®çš„/è¼¸å‡º/æˆªæ­¢æ™‚é–“ã€ä¸¦é™„ä¸€å€‹ç¯„ä¾‹ã€‚
    </div>
  `;
  root.appendChild(action);

  // CTA
  const expand = el("button","btn","å±•é–‹å®Œæ•´ç‰ˆ");
  expand.addEventListener("click", ()=>{
    alert("Demoï¼šå®Œæ•´ç‰ˆå¯åœ¨ä¸‹ä¸€ç‰ˆæ¥ AI å ±å‘Šæ¨¡æ¿ / Google Sheet æ˜Ÿç­‰è¨ˆç®—ã€‚");
  });
  root.appendChild(expand);

  const share = el("button","btn secondary","åˆ†äº«æ‘˜è¦");
  share.addEventListener("click", async ()=>{
    const text = `${BUILD}\nä¸»é¡Œï¼š${state.topic}\næ¨¡å¼ï¼š${BANK[state.mode].name}\næ˜Ÿç­‰ï¼š${Math.round(score.overall)}\nï¼ˆDemoï¼‰`;
    try{
      if(navigator.share){
        await navigator.share({ title: "M9/M12 ç›¤é»æ‘˜è¦", text });
      }else{
        await navigator.clipboard.writeText(text);
        alert("å·²è¤‡è£½æ‘˜è¦åˆ°å‰ªè²¼ç°¿");
      }
    }catch(e){
      // ignore
    }
  });
  root.appendChild(share);

  const clear = el("button","btn ghost","æ¸…é™¤è‰ç¨¿/é‡åš");
  clear.addEventListener("click", ()=>{
    clearDraft();
    state.page = "home";
    state.answers = [];
    state.idx = 0;
    render();
  });
  root.appendChild(clear);

  const foot = el("div","hint",
    `å•†æ¥­åŒ–å°é»ï¼šå®Œæ•´ç‰ˆå¯åŠ ã€Œ30 å¤©è¡Œå‹•è¨ˆç•«ã€ã€Œåœ˜éšŠå°ç…§ã€ã€Œé¡§å•è¨ªè«‡æç¶±ã€ã€‚<br>` +
    `ï¼ˆç•¶å‰ä¸»é¡Œè‰ç¨¿å·²ä¿ç•™ï¼Œæ›ä¸»é¡Œä¹Ÿä¸æœƒè¦†è“‹ã€‚ï¼‰`
  );
  root.appendChild(foot);
}

/* =========================================================
   Mode + Draft handling
   ========================================================= */
function loadMode(){
  return localStorage.getItem(LS_MODE_KEY) || "M12";
}
function saveMode(m){
  localStorage.setItem(LS_MODE_KEY, m);
}
function loadTopic(){
  return localStorage.getItem(LS_TOPIC_KEY) || "";
}
function saveTopic(t){
  localStorage.setItem(LS_TOPIC_KEY, t || "");
}
function draftKey(){
  const topic = (state.topic || "").trim();
  return `${LS_DRAFT_PREFIX}__${state.mode}__${topic}`;
}
function loadDraftIfAny(forceReload=false){
  const topic = (state.topic || "").trim();
  if(!topic) return;

  if(forceReload){
    // ç›´æ¥é‡è¼‰
  }

  const raw = localStorage.getItem(draftKey());
  if(!raw){
    // åˆå§‹åŒ–
    state.answers = new Array(BANK[state.mode].questionCount).fill(0);
    state.idx = 0;
    return;
  }
  try{
    const data = JSON.parse(raw);
    const n = BANK[state.mode].questionCount;
    state.answers = (data.answers || []).slice(0, n);
    while(state.answers.length < n) state.answers.push(0);
    state.idx = Math.min(data.idx || 0, n-1);
  }catch(e){
    state.answers = new Array(BANK[state.mode].questionCount).fill(0);
    state.idx = 0;
  }
}
function saveDraft(){
  const topic = (state.topic || "").trim();
  if(!topic) return;
  localStorage.setItem(draftKey(), JSON.stringify({
    answers: state.answers,
    idx: state.idx,
    savedAt: Date.now()
  }));
}
function clearDraft(){
  const topic = (state.topic || "").trim();
  if(!topic) return;
  localStorage.removeItem(draftKey());
}
function startQuiz(){
  // ä¿è­‰ answers é•·åº¦æ­£ç¢º
  const n = BANK[state.mode].questionCount;
  if(!state.answers || state.answers.length !== n){
    state.answers = new Array(n).fill(0);
    state.idx = 0;
  }
  state.page = "quiz";
  saveDraft();
  render();
}

/* =========================================================
   Advanced Settings Modal
   ========================================================= */
function hookModal(){
  const back = document.getElementById("modalBack");
  const btnM9 = document.getElementById("btnM9");
  const btnM12 = document.getElementById("btnM12");

  function paint(){
    btnM9.classList.toggle("active", state.mode === "M9");
    btnM12.classList.toggle("active", state.mode === "M12");
  }

  btnM9.addEventListener("click", ()=>{ state.mode="M9"; paint(); });
  btnM12.addEventListener("click", ()=>{ state.mode="M12"; paint(); });

  document.getElementById("btnCancel").addEventListener("click", closeModal);

  document.getElementById("btnSave").addEventListener("click", ()=>{
    // å„²å­˜ mode
    saveMode(state.mode);

    // mode æ”¹è®Šæ™‚ï¼šé‡æ–°è¼‰å…¥è©²æ¨¡å¼+ä¸»é¡Œçš„è‰ç¨¿ï¼ˆäº’ä¸è¦†è“‹ï¼‰
    loadDraftIfAny(true);

    closeModalè¯æ˜();
  });

  back.addEventListener("click", (e)=>{
    if(e.target === back) closeModal();
  });

  // é¦–æ¬¡ paint
  paint();
}

function openModal(){
  const back = document.getElementById("modalBack");
  back.style.display = "flex";

  // é‡æ–°æ¨™è¨˜ active
  document.getElementById("btnM9").classList.toggle("active", state.mode === "M9");
  document.getElementById("btnM12").classList.toggle("active", state.mode === "M12");
}
function closeModal(){
  document.getElementById("modalBack").style.display = "none";
}
function closeModalè¯æ˜(){
  closeModal();
  render();
}

/* =========================================================
   Scoring + Insights
   ========================================================= */
function calcScore(){
  const arr = state.answers || [];
  const total = arr.length;
  const answered = arr.filter(v=>v>0).length;
  const avg = answered ? arr.reduce((a,b)=>a+b,0)/answered : 0;

  // å›ºå®š 8 ç¶­åº¦ï¼ˆdemoï¼‰
  const dims = DIMENSIONS.map((name, i)=>{
    const v = arr[i % arr.length] || 0;
    const stars = toStars(v || Math.max(1, Math.round(avg)));
    return { name, stars };
  });

  return {
    total,
    answered,
    overall: Math.max(1, Math.min(5, avg || 3)),
    dims
  };
}

function toStars(v){
  const n = Math.max(1, Math.min(5, Math.round(v)));
  return n;
}

function buildInsights(score, style){
  const strength = pickTopDim(score.dims);
  const weak = pickBottomDim(score.dims);

  const base = [
    {
      tag: `æ´å¯Ÿ 1ï¼ˆå„ªå‹¢ï¼‰ï½œå„ªå‹¢åœ¨ã€Œ${strength.name}ã€`,
      text: style==="long"
        ? `ä½ åœ¨ã€Œ${strength.name}ã€çš„è¡¨ç¾è¼ƒç©©å®šï¼Œé€šå¸¸èƒ½æŠŠäº‹æƒ…æ¨é€²åˆ°å¯è¢«ä»–äººç†è§£èˆ‡æ¡ç´çš„ç¨‹åº¦ã€‚å»ºè­°æŠŠä½ å¸¸ç”¨çš„æˆåŠŸåšæ³•å¯«æˆ 3 æ¢ã€Œå¯è¤‡ç”¨å¥å‹ã€ï¼Œè®“åœ˜éšŠè·Ÿè‘—ç”¨ã€‚`
        : `ä½ åœ¨ã€Œ${strength.name}ã€è¡¨ç¾ç©©å®šï¼Œå»ºè­°æŠŠæˆåŠŸåšæ³•æ•´ç†æˆ 3 æ¢å¯è¤‡ç”¨å¥å‹ã€‚`
    },
    {
      tag: `æ´å¯Ÿ 2ï¼ˆé¢¨éšªï¼‰ï½œçŸ­æ¿åœ¨ã€Œ${weak.name}ã€`,
      text: style==="long"
        ? `ã€Œ${weak.name}ã€è¼ƒå®¹æ˜“è®Šæˆå¡é—œé»ï¼šä¸æ˜¯èƒ½åŠ›ä¸è¶³ï¼Œè€Œæ˜¯ç¼ºå°‘å›ºå®šæµç¨‹æˆ–å›è·¯ã€‚ä½ å¯ä»¥å…ˆæŠŠæ­¤é¢å‘æ‹†æˆ 2 å€‹å¯è§€å¯Ÿå‹•ä½œï¼ˆä¾‹å¦‚ï¼šæ¯æ¬¡æœƒè­°çµå°¾å›ºå®šåšç¢ºèªï¼å›é¥‹ï¼‰ã€‚`
        : `ã€Œ${weak.name}ã€æ˜¯ä¸»è¦é¢¨éšªé»ï¼šå…ˆç”¨å›ºå®šæµç¨‹è£œä¸Šå›è·¯ã€‚`
    },
    {
      tag: `æ´å¯Ÿ 3ï¼ˆå‡ç´šï¼‰ï½œå…ˆæŠŠã€Œä¸€ä»¶äº‹åšåˆ°å¯é æœŸã€`,
      text: style==="long"
        ? `å…ˆé¸ 1â€“2 å€‹é«˜é »æƒ…å¢ƒï¼ˆä¾‹ï¼šäº¤è¾¦ã€å°é½Šã€è®Šæ›´éœ€æ±‚ï¼‰ï¼Œç”¨å›ºå®šæ ¼å¼è™•ç†ï¼šç›®çš„ â†’ è¼¸å‡º â†’ æˆªæ­¢æ™‚é–“ â†’ é©—æ”¶æ–¹å¼ã€‚ä½ æœƒæ˜é¡¯é™ä½æºé€šæˆæœ¬ï¼Œä¹Ÿæ›´å®¹æ˜“è¢«ä¿¡ä»»ã€‚`
        : `é¸ 1â€“2 å€‹é«˜é »æƒ…å¢ƒï¼Œå›ºå®šç”¨ï¼šç›®çš„_ATTACHMENT â†’ è¼¸å‡º â†’ æˆªæ­¢æ™‚é–“ â†’ é©—æ”¶æ–¹å¼ã€‚`
    }
  ];
  return base;
}

function pickTopDim(dims){
  // ä»¥æ˜Ÿæ˜Ÿæœ€å¤šç‚º top
  return dims.reduce((best, cur)=>{
    return cur.stars > best.stars ? cur : best;
  }, dims[0]);
}
function pickBottomDim(dims){
  return dims.reduce((best, cur)=>{
    return cur.stars < best.stars ? cur : best;
  }, dims[0]);
}

/* =========================================================
   Helpers
   ========================================================= */
function el(tag, cls, ...parts){
  const e = document.createElement(tag);
  if (cls) e.className = cls;

  for (const p of parts){
    if (p === null || p === undefined) continue;

    // å­—ä¸²ï¼šå…è¨±å¸¶ HTMLï¼ˆä¾‹å¦‚ <b>...ï¼‰
    if (typeof p === "string"){
      e.insertAdjacentHTML("beforeend", p);
      continue;
    }

    // ç¯€é»ï¼šç›´æ¥ append
    if (p instanceof Node){
      e.appendChild(p);
      continue;
    }

    // å…¶ä»–å‹åˆ¥ï¼šç•¶æ–‡å­—å¡é€²å»
    e.appendChild(document.createTextNode(String(p)));
  }
  return e;
}

}
  
function renderStars(n){
  let out = "";
  for(let i=1;i<=5;i++){
    out += `<span class="star ${i<=n ? "on":"off"}">â˜…</span>`;
  }
  return out;
}
function shake(node){
  node.animate(
    [{transform:"translateX(0)"},{transform:"translateX(-6px)"},{transform:"translateX(6px)"},{transform:"translateX(0)"}],
    {duration: 240, iterations: 1}
  );
}
function getHHMM(){
  const d = new Date();
  const hh = String(d.getHours()).padStart(2,"0");
  const mm = String(d.getMinutes()).padStart(2,"0");
  return `${hh}:${mm}`;
}
</script>
</body>
</html>

