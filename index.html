<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>M9/M12 Demo (Single-file)</title>
  <style>
    :root{
      --bg:#F6F8FB;
      --card:#FFFFFF;
      --ink:#0B1220;
      --muted:#667085;
      --line:#E6EAF2;
      --primary:#2F6FED;
      --primary-2:#1F56C5;
      --accent:#F59E0B;
      --good:#16A34A;
      --shadow: 0 12px 35px rgba(14,30,66,.14);
      --radius: 18px;
      --radius2: 14px;
      --font: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", Arial, sans-serif;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: var(--font);
      color:var(--ink);
      background:
        radial-gradient(1100px 600px at 20% -20%, rgba(47,111,237,.12), transparent 60%),
        radial-gradient(900px 500px at 95% 20%, rgba(245,158,11,.10), transparent 55%),
        var(--bg);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:10px;
    }

    /* Phone mock */
    .phone{
      width:min(460px, 98vw);
      height:min(980px, 96vh);
      background: linear-gradient(180deg, #6F7785, #3E4654); /* ç°æ¡† */
      border-radius:34px;
      padding:14px;
      box-shadow: 0 18px 60px rgba(0,0,0,.20);
    }
    .bezel{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.12));
      border-radius:28px;
      padding:10px;
      position:relative;
      height:100%;
    }
    .screen{
      background: linear-gradient(180deg, #FFFFFF, #F7FAFF);
      border-radius:22px;
      overflow:hidden;
      position:relative;
      height:100%;
      display:flex;
      flex-direction:column;
    }
    .statusbar{
      height:44px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 16px;
      color:#111827;
      font-weight:600;
      font-size:13px;
      opacity:.9;
      flex:0 0 auto;
    }
    .status-icons{display:flex;gap:10px;align-items:center;font-weight:700}
    .pill{
      width:128px;height:28px;border-radius:18px;
      background: rgba(17,24,39,.10);
      margin:6px auto 10px;
      flex:0 0 auto;
    }

    .build{
      position:absolute;
      top:52px;
      right:14px;
      z-index:20;
      font-size:12px;
      color: rgba(0,0,0,.55);
      background: rgba(255,255,255,.75);
      border: 1px solid rgba(230,234,242,.9);
      padding: 6px 8px;
      border-radius: 10px;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      user-select:text;
      white-space:nowrap;
    }

    /* Views */
    .view{display:none; flex:1 1 auto; overflow:auto;}
    .view.active{display:block}
    .wrap{padding:18px 18px 22px}
    h1{margin:0 0 10px; font-size:26px; line-height:1.2}
    p{margin:8px 0 0; color:var(--muted); line-height:1.45}
    .spacer{height:14px}

    .input{
      width:100%;
      border:1px solid var(--line);
      background:#fff;
      border-radius:14px;
      padding:14px 14px;
      font-size:15px;
      outline:none;
      box-shadow: 0 6px 16px rgba(16,24,40,.04);
    }

    .chips{display:flex;flex-wrap:wrap;gap:10px}
    .chip{
      border:1px solid var(--line);
      background:#fff;
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      transition:.15s;
    }
    .chip:hover{border-color:#CFD6E6}
    .chip.active{
      border-color: rgba(47,111,237,.55);
      background: rgba(47,111,237,.10);
      color:#1F56C5;
      font-weight:700;
    }

    .btn{
      width:100%;
      border:none;
      border-radius:16px;
      padding:14px 14px;
      background: linear-gradient(180deg, var(--primary), var(--primary-2));
      color:#fff;
      font-weight:800;
      font-size:15px;
      cursor:pointer;
      box-shadow: 0 14px 30px rgba(47,111,237,.24);
    }
    .btn.ghost{
      background:#fff;
      color:var(--ink);
      border:1px solid var(--line);
      box-shadow:none;
      font-weight:700;
    }
    .btn:active{transform: translateY(1px)}
    .btnrow{display:flex; gap:10px}
    .btnrow .btn{width:50%}

    .linkrow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
      cursor:pointer;
      user-select:none;
    }
    .chev{color:var(--muted);font-size:18px}

    .card{
      border:1px solid var(--line);
      border-radius:16px;
      background:var(--card);
      padding:14px 14px;
      box-shadow: 0 8px 20px rgba(16,24,40,.06);
    }
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .kpi{font-weight:800}
    .small{font-size:12.5px;color:var(--muted);line-height:1.4}

    .topnav{
      position:sticky; top:0;
      background: rgba(255,255,255,.82);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(230,234,242,.7);
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      z-index:5;
    }
    .back{
      display:flex;align-items:center;gap:6px;
      color:var(--primary-2);
      font-weight:800;
      cursor:pointer;
      user-select:none;
    }
    .step{color:var(--muted);font-weight:800;font-size:13px}

    .qtitle{font-weight:900;font-size:18px;margin:0 0 6px}
    .qdesc{margin:0;color:var(--muted);font-size:13.5px;line-height:1.45}

    .opt{
      border:1px solid var(--line);
      background:#fff;
      border-radius:16px;
      padding:12px 12px;
      cursor:pointer;
      user-select:none;
      transition:.15s;
    }
    .opt:hover{border-color:#CFD6E6}
    .opt.selected{
      border-color: rgba(47,111,237,.55);
      background: rgba(47,111,237,.10);
    }

    .bar{
      height:10px;
      border-radius:999px;
      background:#EEF2FF;
      overflow:hidden;
      border:1px solid rgba(230,234,242,.7);
    }
    .bar > div{height:100%; background: rgba(47,111,237,.65); width:0%}

    .stars{display:flex; gap:4px; align-items:center}
    .star{font-size:14px; opacity:.25}
    .star.on{opacity:1}

    @media (max-width:520px){
      body{ padding:6px; }
      .phone{ width: calc(100vw - 8px); height: calc(100vh - 8px); border-radius: 32px; }
      .bezel{ border-radius: 26px; }
      .screen{ border-radius: 20px; }
    }
  </style>
</head>

<body>
  <div class="phone">
    <div class="bezel">
      <div class="screen">
        <div class="statusbar">
          <div id="clock">9:41</div>
          <div class="status-icons"><span>â–®â–®â–®</span><span>âŒ</span><span>ğŸ”‹</span></div>
        </div>
        <div class="pill"></div>
        <div class="build" id="buildLabel"></div>

        <!-- S1 -->
        <section id="v-s1" class="view active">
          <div class="wrap">
            <h1>ä½ æƒ³ç›¤é»å“ªå€‹<br/>è·å ´èƒ½åŠ›ï¼Ÿ</h1>
            <p>åƒåšã€Œæ—…éŠæ›¸ã€ä¸€æ¨£ï¼Œ3â€“5 åˆ†é˜å®Œæˆç›¤é»ï¼Œç«‹å³æ‹¿åˆ°æ˜Ÿç­‰èˆ‡å»ºè­°ã€‚</p>

            <div class="spacer"></div>
            <input id="targetInput" class="input" placeholder="ä¾‹å¦‚ï¼šæºé€šå”ä½œ / åŸ·è¡Œæ¨é€² / å•é¡Œè§£æ±º / é ˜å°å¸¶äºº" />

            <div class="spacer"></div>
            <div class="chips" id="presetChips"></div>

            <div class="spacer"></div>
            <div id="advRow" class="linkrow">
              <span>é€²éšè¨­å®š</span>
              <span class="chev">â€º</span>
            </div>

            <div class="spacer"></div>
            <button id="btnToOverview1" class="btn">é–‹å§‹ç›¤é»</button>

            <div class="spacer"></div>
            <div class="small">
              å³ä¸Šè§’é¡¯ç¤ºç‰ˆæœ¬è™Ÿï¼ˆBuildï¼‰ï¼‹ç›®å‰æ¨¡å‹ï¼ˆM9/M12ï¼‰ï¼Œé¿å…äº¤ä»˜ç‰ˆæœ¬æ··äº‚ã€‚
            </div>
          </div>
        </section>

        <!-- S2 -->
        <section id="v-s2" class="view">
          <div class="topnav">
            <div class="back" data-back="v-s1">
              <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M15.5 19 8.5 12l7-7"/></svg>
              è¿”å›
            </div>
            <div class="step">é€²éšè¨­å®š</div>
            <div style="width:48px"></div>
          </div>

          <div class="wrap">
            <!-- æ¨¡å‹åˆ‡æ›ï¼šæ”¾æœ€ä¸Šé¢ -->
            <div class="card">
              <div class="row" style="align-items:flex-start">
                <div>
                  <div class="kpi">æ¨¡å‹åˆ‡æ›</div>
                  <div class="small" style="margin-top:4px">å…ˆæ±ºå®šç”¨ M9 æˆ– M12ï¼Œå†èª¿æ•´å ±å‘Šé¢¨æ ¼ã€‚</div>
                </div>
              </div>
              <div class="spacer"></div>
              <div class="chips" id="modelChips">
                <div class="chip model" data-model="M9">M9ï¼ˆè·å ´æ ¸å¿ƒï¼‰</div>
                <div class="chip model" data-model="M12">M12ï¼ˆç®¡ç†/æˆé•·ï¼‰</div>
              </div>
            </div>

            <div class="spacer"></div>

            <h1>å ±å‘Šæƒ³åä»€éº¼<br/>é¢¨æ ¼ï¼Ÿ</h1>
            <p>ä½ å¯ä»¥å…ˆç”¨é è¨­ï¼Œä¹‹å¾Œå†èª¿æ•´ï¼ˆä¸å½±éŸ¿å®Œæˆï¼‰ã€‚</p>

            <div class="spacer"></div>

            <div class="card">
              <div class="kpi">èªæ°£</div>
              <div class="spacer"></div>
              <div class="chips">
                <div class="chip pref" data-key="tone" data-val="direct">ç›´æ¥æ¸…æ¥š</div>
                <div class="chip pref" data-key="tone" data-val="warm">æº«å’Œé¼“å‹µ</div>
                <div class="chip pref" data-key="tone" data-val="formal">å•†å‹™æ­£å¼</div>
              </div>

              <div class="spacer"></div>

              <div class="kpi">ç„¦é»</div>
              <div class="spacer"></div>
              <div class="chips">
                <div class="chip pref" data-key="focus" data-val="action">å¯åŸ·è¡Œå»ºè­°</div>
                <div class="chip pref" data-key="focus" data-val="strategy">ç­–ç•¥è„ˆçµ¡</div>
                <div class="chip pref" data-key="focus" data-val="coach">æ•™ç·´å¼•å°</div>
              </div>

              <div class="spacer"></div>

              <div class="kpi">ä½ çš„è§’è‰²</div>
              <div class="spacer"></div>
              <div class="chips">
                <div class="chip pref" data-key="role" data-val="individual">å€‹äººè²¢ç»è€…</div>
                <div class="chip pref" data-key="role" data-val="lead">å¸¶äººä¸»ç®¡</div>
                <div class="chip pref" data-key="role" data-val="owner">è² è²¬äºº/è€é—†</div>
              </div>
            </div>

            <div class="spacer"></div>
            <button id="btnToOverview2" class="btn">å®Œæˆè¨­å®šï¼Œé–‹å§‹</button>

            <div class="spacer"></div>
            <div class="small"><strong>éš±ç§ï¼š</strong>æ­¤ Demo ä¸ä¸Šå‚³è³‡æ–™ã€‚è‰ç¨¿åƒ…å­˜åœ¨æœ¬æ©Ÿ localStorageã€‚</div>
          </div>
        </section>

        <!-- S3 -->
        <section id="v-s3" class="view">
          <div class="topnav">
            <div class="back" data-back="v-s1">
              <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M15.5 19 8.5 12l7-7"/></svg>
              é¦–é 
            </div>
            <div class="step">æ¦‚è¦½</div>
            <div style="width:48px"></div>
          </div>

          <div class="wrap">
            <h1 id="ovTitle">ä¸»é¡Œï¼šâ€”</h1>
            <p id="ovHint">â€”</p>

            <div class="spacer"></div>

            <div class="card">
              <div class="row">
                <div class="kpi">é€²åº¦</div>
                <div class="small" id="ovProgress">0/8</div>
              </div>
              <div class="spacer"></div>
              <div class="bar"><div id="ovBar"></div></div>

              <div class="spacer"></div>
              <div class="row">
                <div class="small" id="ovModel">æ¨¡å‹ï¼šâ€”</div>
                <div class="small" id="ovTone">é¢¨æ ¼ï¼šâ€”</div>
              </div>
            </div>

            <div class="spacer"></div>

            <button id="btnStartQuiz" class="btn">é–‹å§‹ç­”é¡Œ</button>
            <div class="spacer"></div>
            <div class="btnrow">
              <button id="btnResetTopic" class="btn ghost">æ¸…é™¤æ­¤ä¸»é¡Œè‰ç¨¿</button>
              <button id="btnResetAll" class="btn ghost">æ¸…é™¤å…¨éƒ¨</button>
            </div>

            <div class="spacer"></div>
            <div class="small">
              ä½ åˆ‡æ› M9/M12 ä¸æœƒäº’ç›¸è¦†è“‹è‰ç¨¿ï¼šå„²å­˜ key = <code>model + topic</code>ã€‚
            </div>
          </div>
        </section>

        <!-- S4 -->
        <section id="v-s4" class="view">
          <div class="topnav">
            <div class="back" id="btnBackToOv">
              <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M15.5 19 8.5 12l7-7"/></svg>
              æ¦‚è¦½
            </div>
            <div class="step" id="qStep">1/8</div>
            <div style="width:48px"></div>
          </div>

          <div class="wrap">
            <div class="card">
              <div class="row">
                <div class="kpi" id="qDim">â€”</div>
                <div class="small" id="qId">â€”</div>
              </div>
              <div class="spacer"></div>
              <div class="qtitle" id="qTitle">â€”</div>
              <p class="qdesc" id="qDesc">â€”</p>
            </div>

            <div class="spacer"></div>
            <div id="optBox" style="display:flex;flex-direction:column;gap:10px"></div>

            <div class="spacer"></div>
            <div class="btnrow">
              <button id="btnPrev" class="btn ghost">ä¸Šä¸€é¡Œ</button>
              <button id="btnNext" class="btn">ä¸‹ä¸€æ­¥</button>
            </div>

            <div class="spacer"></div>
            <div class="small" id="qTip">å¯é¸ã€Œä¸ç¢ºå®šã€ï¼šæœƒè¨ˆå…¥ä¸ç¢ºå®šæ¬¡æ•¸ï¼Œä½†ä¸å½±éŸ¿ä½ ç¹¼çºŒç­”é¡Œã€‚</div>
          </div>
        </section>

        <!-- S5 -->
        <section id="v-s5" class="view">
          <div class="topnav">
            <div class="back" data-back="v-s3">
              <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M15.5 19 8.5 12l7-7"/></svg>
              æ¦‚è¦½
            </div>
            <div class="step">çµæœ</div>
            <div style="width:48px"></div>
          </div>

          <div class="wrap">
            <h1 id="rsTitle">ä½ çš„æ˜Ÿç­‰ï¼šâ€”</h1>
            <p id="rsSub">â€”</p>

            <div class="spacer"></div>
            <div class="card" id="rsDims"></div>

            <div class="spacer"></div>
            <button id="btnToReport" class="btn">ç”Ÿæˆ AI å ±å‘Š</button>

            <div class="spacer"></div>
            <div class="small" id="rsMeta">â€”</div>
          </div>
        </section>

        <!-- S6 -->
        <section id="v-s6" class="view">
          <div class="topnav">
            <div class="back" data-back="v-s5">
              <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M15.5 19 8.5 12l7-7"/></svg>
              çµæœ
            </div>
            <div class="step">AI å ±å‘Š</div>
            <div style="width:48px"></div>
          </div>

          <div class="wrap">
            <h1>ä½ çš„èƒ½åŠ›ç›¤é»å ±å‘Š</h1>
            <p id="rpSub">â€”</p>

            <div class="spacer"></div>
            <div class="card" id="rpBody"></div>

            <div class="spacer"></div>
            <button class="btn ghost" data-back="v-s1">å›åˆ°é¦–é </button>
          </div>
        </section>

      </div>
    </div>
  </div>

<script>
/** ======================================================
 *  Build / Model
 * ====================================================== */
const BUILD_LABEL_BASE = "UIA-BANKB v1.0.2 2025-12-30";

/** ======================================================
 *  é¡Œåº«ï¼ˆHard-codeï¼‰
 *  - æ¯å€‹ä¸»é¡Œ 8 é¡Œ
 * ====================================================== */
const QUESTION_BANK_M9 = {
  "æºé€šå”ä½œ": {
    hint: "èšç„¦ï¼šè¨Šæ¯æ¸…æ¥šã€å…±è­˜å°é½Šã€è·¨éƒ¨é–€æ¨é€²ã€‚",
    questions: [
      {id:"C1", title:"è·¨éƒ¨é–€å”ä½œå¡ä½", desc:"å°æ–¹å›è¦†æ…¢ã€éœ€æ±‚åè¦†ï¼Œé€²åº¦è½å¾Œã€‚ä½ é€šå¸¸æ€éº¼åšï¼Ÿ", dim:"å”ä½œæ¨é€²",
        options:[{text:"å…ˆé‡æ¸…ç›®æ¨™/è²¬ä»»åˆ†å·¥ï¼Œç´„å®šæœ€å°å¯äº¤ä»˜ï¼ˆMVPï¼‰",score:5},{text:"å…ˆè¨˜éŒ„èµ·ä¾†ç­‰ä¾‹æœƒå†è«‡",score:3},{text:"è¦æ±‚å°æ–¹ç…§åŸè¨ˆç•«åš",score:2},{text:"è‡ªå·±åšå®Œå°æ–¹é…åˆå³å¯",score:1}]},
      {id:"C2", title:"è¨Šæ¯è¢«èª¤è§£é€ æˆé‡å·¥", desc:"äº¤è¾¦å…§å®¹è¢«ç†è§£æˆå¦ä¸€ä»¶äº‹ï¼Œé€ æˆé‡å·¥ã€‚ä½ æœƒæ€éº¼æ”¹å–„ï¼Ÿ", dim:"æºé€šæ¸…æ™°",
        options:[{text:"æ”¹ç”¨ã€ç¢ºèªå›è¦†ã€ï¼šå°æ–¹å¾©è¿°é‡é»+äº¤ä»˜ç‰©",score:5},{text:"åŠ é•·æ–‡å­—èªªæ˜é¿å…èª¤å·®",score:3},{text:"ä¹‹å¾Œéƒ½å£é ­äº¤è¾¦å°±å¥½",score:2},{text:"ç®—äº†ä»¥å¾Œæˆ‘è‡ªå·±åš",score:1}]},
      {id:"C3", title:"æœƒè­°ç„¡æ³•æ”¶æ–‚", desc:"è¨è«–ç™¼æ•£ã€æœ€å¾Œæ²’çµè«–ã€‚ä½ æœƒæ€éº¼è™•ç†ï¼Ÿ", dim:"æœƒè­°æ”¶æ–‚",
        options:[{text:"å…ˆå®šè­°ç¨‹/æ±ºç­–é¡Œ/æ™‚é–“ç›’ï¼Œæœ€å¾Œè¼¸å‡ºçµè«–èˆ‡Action",score:5},{text:"è®“å¤§å®¶å¤šèŠèŠç¸½æœƒæœ‰å…±è­˜",score:3},{text:"ç›´æ¥ç”¨ä½ çš„æ–¹æ¡ˆæ‹æ¿",score:2},{text:"å…ˆæ•£æœƒæ”¹å¤©å†èªª",score:1}]},
      {id:"C4", title:"å°é½ŠæœŸæœ›", desc:"åŒä¸€ä»¶äº‹å„è‡ªè§£è®€ä¸åŒï¼Œé€ æˆçˆ­åŸ·ã€‚ä½ æœƒæ€éº¼åšï¼Ÿ", dim:"å…±è­˜å°é½Š",
        options:[{text:"æŠŠç›®æ¨™ã€ç¯„åœã€é©—æ”¶æ¨™æº–å¯«æˆ 1 é å°é½Š",score:5},{text:"å†å¤šè§£é‡‹ä¸€æ¬¡ä½ çš„æƒ³æ³•",score:3},{text:"äº¤çµ¦ä¸»ç®¡è£æ±º",score:2},{text:"å…ˆæ”¾è‘—ä¸è¦ç¢°",score:1}]},
      {id:"C5", title:"è¡çªè™•ç†", desc:"åˆä½œå¤¥ä¼´æƒ…ç·’ä¸Šä¾†ã€äº’ç›¸æŒ‡è²¬ã€‚ä½ æœƒæ€éº¼åšï¼Ÿ", dim:"è¡çªç®¡ç†",
        options:[{text:"å…ˆæ‹†äº‹å¯¦/å½±éŸ¿/éœ€æ±‚ï¼Œæ‹‰å›å…±åŒç›®æ¨™å†è«‡æ–¹æ¡ˆ",score:5},{text:"å…ˆå®‰æ’«æƒ…ç·’ï¼Œç­‰å†·éœå†èªª",score:3},{text:"èª°å¤§è²è½èª°çš„",score:2},{text:"é¿å…è¡çªï¼Œå…ˆé€€å‡º",score:1}]},
      {id:"C6", title:"å‘ä¸Šæºé€š", desc:"ä½ éœ€è¦ä¸»ç®¡æ”¯æŒï¼Œä½†ä»–å¾ˆå¿™ã€‚ä½ æœƒæ€éº¼æï¼Ÿ", dim:"å‘ä¸Šæºé€š",
        options:[{text:"ç”¨ 30 ç§’ TL;DRï¼šé¸é …/æˆæœ¬/å»ºè­°ï¼Œè®“ä»–å¿«æ±ºç­–",score:5},{text:"æŠŠèƒŒæ™¯å…¨éƒ¨è¬›æ¸…æ¥š",score:3},{text:"ä¸€ç›´è¿½å•ç›´åˆ°å›è¦†",score:2},{text:"ç®—äº†ä¸æäº†",score:1}]},
      {id:"C7", title:"è·¨æ–‡åŒ–/è·¨åœ°å€åˆä½œ", desc:"èªè¨€/æ™‚å€ä¸åŒï¼Œå®¹æ˜“èª¤è§£å»¶èª¤ã€‚ä½ æœƒæ€éº¼åšï¼Ÿ", dim:"å”ä½œæ©Ÿåˆ¶",
        options:[{text:"å»ºç«‹å›ºå®šç¯€å¥ï¼šåŒæ­¥/ç•°æ­¥è¦å‰‡èˆ‡æ¨¡æ¿",score:5},{text:"çœ‹æƒ…æ³å†èª¿æ•´",score:3},{text:"è¦æ±‚å°æ–¹é…åˆä½ æ™‚é–“",score:2},{text:"å„åšå„çš„",score:1}]},
      {id:"C8", title:"å›é¥‹èˆ‡è¿­ä»£", desc:"å°æ–¹çµ¦çš„å›é¥‹å¾ˆæŠ½è±¡ã€‚ä½ æœƒæ€éº¼æŠŠå®ƒè®Šå¯è¡Œå‹•ï¼Ÿ", dim:"å›é¥‹è½‰åŒ–",
        options:[{text:"è¿½å•å…·é«”ä¾‹å­+æœŸæœ›çµæœï¼Œè½‰æˆå¯é©—æ”¶æ¸…å–®",score:5},{text:"å…ˆç…§æ„Ÿè¦ºæ”¹æ”¹çœ‹",score:3},{text:"è¦ºå¾—ä¸é‡è¦å°±å¿½ç•¥",score:2},{text:"å¤ªéº»ç…©å…ˆæ”¾è‘—",score:1}]},
    ]
  },

  "åŸ·è¡Œæ¨é€²": {
    hint: "èšç„¦ï¼šæ‹†è§£ä»»å‹™ã€ç¯€é»æ§ç®¡ã€æŠŠäº‹åšå®Œã€‚",
    questions: [
      {id:"E1", title:"ç›®æ¨™æ‹†è§£", desc:"ç›®æ¨™å¾ˆå¤§ã€å¤§å®¶ä¸çŸ¥é“å¾å“ªé–‹å§‹ã€‚ä½ æœƒæ€éº¼åšï¼Ÿ", dim:"æ‹†è§£èƒ½åŠ›",
        options:[{text:"æ‹†æˆé‡Œç¨‹ç¢‘â†’ä»»å‹™â†’è² è²¬äººâ†’æœŸé™â†’é©—æ”¶æ¨™æº–",score:5},{text:"å…ˆåšå†èªªé‚Šåšé‚Šèª¿",score:3},{text:"æŠŠç›®æ¨™ä¸Ÿçµ¦æœ€å¼·çš„äºº",score:2},{text:"ç­‰éœ€æ±‚æ›´æ¸…æ¥šå†å‹•",score:1}]},
      {id:"E2", title:"å„ªå…ˆé †åºæ··äº‚", desc:"åŒæ™‚å¾ˆå¤šäº‹éƒ½èªªå¾ˆæ€¥ã€‚ä½ æœƒæ€éº¼æ’ï¼Ÿ", dim:"å„ªå…ˆæ’åº",
        options:[{text:"ç”¨å½±éŸ¿Ã—ç·Šæ€¥Ã—æˆæœ¬æ’åºï¼Œå°é½Šåˆ©å®³é—œä¿‚äºº",score:5},{text:"å…ˆåšæœ€å®¹æ˜“çš„",score:3},{text:"èª°å‚¬å°±å…ˆåšèª°",score:2},{text:"å…¨éƒ¨ä¸€èµ·åš",score:1}]},
      {id:"E3", title:"é€²åº¦å»¶é²", desc:"å¿«åˆ° deadline äº†ï¼Œä½†é€²åº¦è½å¾Œã€‚ä½ æœƒæ€éº¼è™•ç†ï¼Ÿ", dim:"é¢¨éšªæ§ç®¡",
        options:[{text:"å…ˆæ‰¾ç“¶é ¸ï¼Œç¸®ç¯„åœ/åŠ è³‡æº/èª¿é †åºï¼Œæ›´æ–°é æœŸ",score:5},{text:"åŠ ç­æŠŠå®ƒç¡¬åšå®Œ",score:3},{text:"å…ˆéš±çï¼Œåšå‡ºä¾†å†èªª",score:2},{text:"æ”¾è‘—ç­‰åˆ¥äººæ•‘",score:1}]},
      {id:"E4", title:"äº¤ä»˜ç‰©å“è³ªä¸ç©©", desc:"åŒæ¨£æµç¨‹æ¯æ¬¡å“è³ªå·®å¾ˆå¤šã€‚ä½ æœƒæ€éº¼æ”¹å–„ï¼Ÿ", dim:"å“è³ªç®¡ç†",
        options:[{text:"å»ºç«‹æª¢æŸ¥æ¸…å–®+ç¯„ä¾‹+Review ç¯€é»",score:5},{text:"å¤šæé†’å¤§å®¶å°å¿ƒé»",score:3},{text:"å‡ºäº‹å†ä¿®",score:2},{text:"æ”¹ç”±ä½ è¦ªè‡ªæŠŠé—œå…¨éƒ¨",score:1}]},
      {id:"E5", title:"éœ€æ±‚é »ç¹è®Šæ›´", desc:"éœ€æ±‚ä¸€ç›´æ”¹ï¼Œåœ˜éšŠç–²æ–¼å¥”å‘½ã€‚ä½ æœƒæ€éº¼åšï¼Ÿ", dim:"è®Šæ›´ç®¡ç†",
        options:[{text:"å»ºç«‹è®Šæ›´æµç¨‹ï¼šå½±éŸ¿è©•ä¼°â†’æ±ºç­–â†’åŒæ­¥â†’ç‰ˆæœ¬åŒ–",score:5},{text:"ç…§å–®å…¨æ”¶å…ˆåš",score:3},{text:"å…¨éƒ¨æ‹’çµ•ä¸æ”¹",score:2},{text:"å…ˆåœå·¥ç­‰éœ€æ±‚ä¸è®Š",score:1}]},
      {id:"E6", title:"å”ä½œå·¥å…·æ··äº‚", desc:"æª”æ¡ˆ/ä»»å‹™æ•£è½å„è™•ã€‚ä½ æœƒæ€éº¼æ•´ç†ï¼Ÿ", dim:"ç³»çµ±åŒ–",
        options:[{text:"çµ±ä¸€å·¥å…·èˆ‡å‘½åè¦å‰‡ï¼Œå›ºå®šé€±æœŸæ•´ç†èˆ‡å›é¡§",score:5},{text:"å…ˆç”¨è‘—ï¼Œæœ‰ç©ºå†æ•´ç†",score:3},{text:"å„è‡ªç¿’æ…£å°±å¥½",score:2},{text:"è®“æ–°äººå»æ•´ç†",score:1}]},
      {id:"E7", title:"è·Ÿé€²èˆ‡å‚¬è¾¦", desc:"æœ‰äººæ‹–å»¶ä¸äº¤ä»˜ã€‚ä½ æœƒæ€éº¼è·Ÿé€²ï¼Ÿ", dim:"æ¨é€²åŠ›",
        options:[{text:"ç¢ºèªé˜»ç¤™â†’æä¾›å”åŠ©â†’é‡è«‡æœŸé™â†’é€æ˜åŒ–é€²åº¦",score:5},{text:"æ¯å¤©æé†’ä¸€æ¬¡",score:3},{text:"ç›´æ¥æŠ±æ€¨ä»–ä¸è² è²¬",score:2},{text:"ç®—äº†æˆ‘è‡ªå·±åš",score:1}]},
      {id:"E8", title:"å¾©ç›¤æ”¹é€²", desc:"å°ˆæ¡ˆçµæŸå¾Œå¸¸é‡è¤‡çŠ¯éŒ¯ã€‚ä½ æœƒæ€éº¼åšï¼Ÿ", dim:"æŒçºŒæ”¹é€²",
        options:[{text:"åšå¾©ç›¤ï¼šåšå°/åšéŒ¯/ä¸‹æ¬¡æ”¹ï¼Œå½¢æˆ SOP æˆ–æ¨¡æ¿",score:5},{text:"å£é ­èŠèŠå°±å¥½",score:3},{text:"æ€ªç½ªæŸå€‹äººå°±çµæŸ",score:2},{text:"ä¸å¾©ç›¤ï¼Œç¹¼çºŒä¸‹ä¸€å€‹",score:1}]},
    ]
  },

  "å•é¡Œè§£æ±º": {
    hint: "èšç„¦ï¼šå®šä½æ ¹å› ã€æå‡ºé¸é …ã€åšå‡ºåˆ¤æ–·ã€‚",
    questions: [
      {id:"P1", title:"ç—‡ç‹€ vs æ ¹å› ", desc:"å•é¡Œåè¦†å‡ºç¾ï¼Œä½ æœƒæ€éº¼æ‰¾æ ¹å› ï¼Ÿ", dim:"æ ¹å› åˆ†æ",
        options:[{text:"ç”¨ 5 Whys / é­šéª¨åœ–æŠŠæ ¹å› æ‹†å‡ºä¾†å†å°ç­–",score:5},{text:"å…ˆé ­ç—›é†«é ­",score:3},{text:"å…ˆæ€ªä½¿ç”¨è€…ä¸æœƒç”¨",score:2},{text:"å…ˆæ”¾è‘—çœ‹çœ‹æœƒä¸æœƒè‡ªå·±å¥½",score:1}]},
      {id:"P2", title:"è³‡è¨Šä¸è¶³ä»è¦æ±ºç­–", desc:"è³‡æ–™ä¸å®Œæ•´ä½†æ™‚é–“ç·Šè¿«ï¼Œä½ æœƒæ€éº¼åšï¼Ÿ", dim:"ä¸ç¢ºå®šæ±ºç­–",
        options:[{text:"æ˜ç¢ºå‡è¨­+é¢¨éšª+æ­¢æé»ï¼Œå…ˆåšå¯é€†æ±ºç­–",score:5},{text:"ç­‰è³‡æ–™é½Šå†æ±ºå®š",score:3},{text:"é ç›´è¦ºæ‹æ¿",score:2},{text:"æŠŠæ±ºç­–ä¸Ÿçµ¦åˆ¥äºº",score:1}]},
      {id:"P3", title:"å¤šæ–¹æ¡ˆé¸æ“‡", desc:"æ–¹æ¡ˆ A/B/C å„æœ‰åˆ©å¼Šï¼Œä½ æœƒæ€éº¼æ¯”è¼ƒï¼Ÿ", dim:"æ–¹æ¡ˆæ¯”è¼ƒ",
        options:[{text:"ç”¨æˆæœ¬/å½±éŸ¿/é¢¨éšª/å¯è¡Œæ€§æ‰“åˆ†ï¼Œæ¨è–¦ä¸€å€‹",score:5},{text:"é¸çœ‹èµ·ä¾†æœ€ç°¡å–®çš„",score:3},{text:"é¸å¤§å®¶åµæœ€å…‡çš„é‚£å€‹",score:2},{text:"æ¯å€‹éƒ½åšä¸€é»",score:1}]},
      {id:"P4", title:"è³‡æ–™é©—è­‰", desc:"æœ‰äººèªªæŸæ•¸æ“šå¾ˆé‡è¦ï¼Œä½†ä½ ä¸ç¢ºå®šã€‚ä½ æœƒæ€éº¼é©—ï¼Ÿ", dim:"é©—è­‰èƒ½åŠ›",
        options:[{text:"å…ˆå®šç¾©æŒ‡æ¨™èˆ‡æ¨£æœ¬ï¼Œåšå¿«é€Ÿé©—è­‰ï¼ˆA/B æˆ–æŠ½æ¨£ï¼‰",score:5},{text:"å…ˆç›¸ä¿¡å°æ–¹",score:3},{text:"è¦ºå¾—éº»ç…©å°±ç•¥é",score:2},{text:"åæ­£æœ€å¾Œå†çœ‹çµæœ",score:1}]},
      {id:"P5", title:"è·¨éƒ¨é–€æ ¹å› ", desc:"å•é¡Œç‰½æ¶‰å¤šéƒ¨é–€äº’ç›¸æ¨è²¬ï¼Œä½ æœƒæ€éº¼æ‹†ï¼Ÿ", dim:"ç³»çµ±æ€è€ƒ",
        options:[{text:"ç•«æµç¨‹/è²¬ä»»é‚Šç•Œï¼Œæ‰¾é—œéµæ–·é»èˆ‡å¯æ§è®Šå› ",score:5},{text:"è«‹ä¸»ç®¡å‡ºé¢å£“ä¸€å£“",score:3},{text:"æŠŠè²¬ä»»æ¨å›åˆ¥éƒ¨é–€",score:2},{text:"é€€å‡ºä¸ç®¡",score:1}]},
      {id:"P6", title:"ç·Šæ€¥äº‹æ•…è™•ç†", desc:"ç·šä¸Šæ•…éšœï¼Œå®¢è¨´æš´å¢ã€‚ä½ æœƒæ€éº¼åšï¼Ÿ", dim:"äº‹æ•…æ‡‰å°",
        options:[{text:"å…ˆæ­¢è¡€â†’å…¬å‘Šâ†’æ’æŸ¥â†’æ ¹å› â†’å¾©ç›¤ï¼Œä¸¦åˆ†å·¥å€¼ç­",score:5},{text:"å…ˆä¿®èƒ½ä¿®çš„",score:3},{text:"ç­‰åˆ¥äººä¾†è™•ç†",score:2},{text:"å…ˆé—œæ‰æœå‹™å†èªª",score:1}]},
      {id:"P7", title:"æ¬Šè¡¡å–æ¨", desc:"è¦é€Ÿåº¦é‚„æ˜¯å“è³ªï¼Ÿä½ æœƒæ€éº¼å–æ¨ï¼Ÿ", dim:"å–æ¨èƒ½åŠ›",
        options:[{text:"å°é½Šç›®æ¨™èˆ‡é¢¨éšªï¼Œå…ˆäº¤ä»˜å¯ç”¨ç‰ˆæœ¬å†è¿­ä»£",score:5},{text:"ä¸€å®šè¦å®Œç¾æ‰äº¤ä»˜",score:3},{text:"åªè¦å¿«ï¼Œå“è³ªä¸ç®¡",score:2},{text:"éƒ½è¦ï¼Œæœ€å¾Œçˆ†æ‰",score:1}]},
      {id:"P8", title:"é‡è¤‡å°å•é¡Œ", desc:"æ¯å¤©éƒ½åœ¨è™•ç†å°å•é¡Œæ‰“æ–·ã€‚ä½ æœƒæ€éº¼æ”¹å–„ï¼Ÿ", dim:"å•é¡Œé é˜²",
        options:[{text:"åˆ†é¡â†’æ‰¾æœ€é«˜é »æ ¹å› â†’ç”¨ SOP/å·¥å…·ä¸€æ¬¡æ€§è§£æ±º",score:5},{text:"æ¯å¤©è¾›è‹¦ä¸€é»æ’éå»",score:3},{text:"æŠŠå•é¡Œä¸Ÿçµ¦æ–°äºº",score:2},{text:"å…ˆæ”¾è‘—åˆ¥ç®¡",score:1}]},
    ]
  },

  "é ˜å°å¸¶äºº": {
    hint: "èšç„¦ï¼šæˆæ¬Šã€å›é¥‹ã€å¸¶å‹•åœ˜éšŠæˆé•·ã€‚",
    questions: [
      {id:"L1", title:"æˆæ¬Š", desc:"ä½ æœƒæ€éº¼æŠŠå·¥ä½œäº¤çµ¦åˆ¥äººåˆä¸å¤±æ§ï¼Ÿ", dim:"æˆæ¬Šç®¡ç†",
        options:[{text:"å…ˆå°é½Šç›®æ¨™/é‚Šç•Œ/é©—æ”¶ï¼Œçµ¦æ–¹æ³•é¸æ“‡ä¸¦è¨­æª¢æŸ¥é»",score:5},{text:"äº¤è¾¦å¾Œæ¯å¤©ç›¯",score:3},{text:"ä¸äº¤è¾¦ï¼Œè‡ªå·±åšæœ€å¿«",score:2},{text:"äº¤å‡ºå»å°±ä¸ç®¡",score:1}]},
      {id:"L2", title:"ç¸¾æ•ˆå›é¥‹", desc:"åŒäº‹è¡¨ç¾ä¸å¦‚é æœŸï¼Œä½ æ€éº¼çµ¦å›é¥‹ï¼Ÿ", dim:"å›é¥‹èƒ½åŠ›",
        options:[{text:"å°±äº‹è«–äº‹ï¼šäº‹å¯¦â†’å½±éŸ¿â†’æœŸæœ›â†’ä¸‹ä¸€æ­¥ï¼Œä¸¦çµ¦è³‡æº",score:5},{text:"å…ˆå¿è‘—ç­‰ä»–è‡ªå·±æ”¹",score:3},{text:"ç”¨æƒ…ç·’å£“è¿«ä»–",score:2},{text:"ç›´æ¥æ›äºº",score:1}]},
      {id:"L3", title:"åŸ¹é¤Šæ–°äºº", desc:"æ–°äººå­¸å¾ˆæ…¢å½±éŸ¿é€²åº¦ï¼Œä½ æœƒæ€éº¼å¸¶ï¼Ÿ", dim:"æ•™ç·´å¸¶æ•™",
        options:[{text:"æ‹†å°æ­¥â†’ç¤ºç¯„â†’ç·´ç¿’â†’å›é¥‹â†’é€æ­¥æ”¾æ‰‹",score:5},{text:"ä¸Ÿæ–‡ä»¶è®“ä»–è‡ªå·±çœ‹",score:3},{text:"è¦ºå¾—éº»ç…©ä¸æƒ³æ•™",score:2},{text:"è®“ä»–å…ˆåšéŒ¯å†ç½µ",score:1}]},
      {id:"L4", title:"åœ˜éšŠè¡çª", desc:"å…©ä½æ ¸å¿ƒæˆå“¡äº’çœ‹ä¸é †çœ¼ã€‚ä½ æœƒæ€éº¼åšï¼Ÿ", dim:"è¡çªèª¿è§£",
        options:[{text:"æ‹‰å›å…±åŒç›®æ¨™ï¼Œé‡æ¸…ç•Œé¢èˆ‡åˆä½œè¦å‰‡",score:5},{text:"è®“ä»–å€‘è‡ªå·±åµå‡ºçµæœ",score:3},{text:"åè¢’ä½ å–œæ­¡çš„é‚£å€‹",score:2},{text:"å…ˆåˆ†é–‹ä¸è®“åˆä½œ",score:1}]},
      {id:"L5", title:"å»ºç«‹æ¨™æº–", desc:"å¤§å®¶å„åšå„çš„é¢¨æ ¼ä¸ä¸€è‡´ã€‚ä½ æœƒæ€éº¼åšï¼Ÿ", dim:"æ¨™æº–åŒ–",
        options:[{text:"å…±åŒå®šç¾©æ¨™æº–èˆ‡ç¯„ä¾‹ï¼Œå»ºç«‹ review æ©Ÿåˆ¶",score:5},{text:"ä½ è‡ªå·±è¨‚è¦å‰‡å°±å¥½",score:3},{text:"æ”¾ä»»è‡ªç”±ç™¼æ®",score:2},{text:"ç­‰å‡ºäº‹å†çµ±ä¸€",score:1}]},
      {id:"L6", title:"æ¿€å‹µ", desc:"åœ˜éšŠå£«æ°£ä½è½ï¼Œä½ æœƒæ€éº¼ææŒ¯ï¼Ÿ", dim:"å‹•æ©Ÿç®¡ç†",
        options:[{text:"å…ˆç†è§£åŸå› ï¼Œèª¿æ•´ç›®æ¨™/è³‡æº/å›é¥‹ï¼Œå‰µé€ å°å‹åˆ©",score:5},{text:"å–Šå£è™ŸåŠ æ²¹",score:3},{text:"ç”¨çæ‡²é€¼ç¸¾æ•ˆ",score:2},{text:"ä¸ç®¡ï¼Œèƒ½è€…å¤šå‹",score:1}]},
      {id:"L7", title:"å°é½Šæ–¹å‘", desc:"åœ˜éšŠè¦ºå¾—åšçš„äº‹æ²’æœ‰æ„ç¾©ã€‚ä½ æœƒæ€éº¼å°é½Šï¼Ÿ", dim:"æ–¹å‘å°é½Š",
        options:[{text:"æŠŠç›®æ¨™é€£åˆ°å®¢æˆ¶åƒ¹å€¼èˆ‡æŒ‡æ¨™ï¼Œè®“æ¯äººçŸ¥é“è²¢ç»é»",score:5},{text:"ä½ èªªäº†ç®—ç…§åš",score:3},{text:"å…ˆåšå®Œå†èªªæ„ç¾©",score:2},{text:"è¦ºå¾—éº»ç…©ä¸è«‡",score:1}]},
      {id:"L8", title:"äººæ‰ç›¤é»", desc:"ä½ æ€éº¼è©•ä¼°èª°é©åˆå‡è·æˆ–æ›ä½ï¼Ÿ", dim:"ç”¨äººåˆ¤æ–·",
        options:[{text:"ç”¨æˆæœ+è¡Œç‚º+æ½›åŠ›ï¼Œå¤šä¾†æºå›é¥‹ä¸¦è¨­è©¦é‹è¡ŒæœŸ",score:5},{text:"çœ‹è³‡æ­·å¹´è³‡",score:3},{text:"çœ‹ä½ å–œä¸å–œæ­¡",score:2},{text:"éš¨ä¾¿å®‰æ’",score:1}]},
    ]
  }
};

// M12ï¼šå…ˆç”¨ placeholderï¼ˆåŒé¡Œåº«æ˜ å°„ä¸åŒä¸»é¡Œï¼‰ï¼Œç¢ºä¿æµç¨‹ç©©å®šï¼›ä¹‹å¾Œå¯æ›¿æ›æˆçœŸæ­£ M12 é¡Œåº«
const QUESTION_BANK_M12 = (()=>{
  const clone = (o)=>JSON.parse(JSON.stringify(o));
  const m9 = QUESTION_BANK_M9;
  const m12 = {
    "ç­–ç•¥è¦åŠƒ": clone(m9["å•é¡Œè§£æ±º"]),
    "æµç¨‹æ²»ç†": clone(m9["åŸ·è¡Œæ¨é€²"]),
    "å•†æ¥­æ•æ„Ÿ": clone(m9["æºé€šå”ä½œ"]),
    "äººæ‰åŸ¹è‚²": clone(m9["é ˜å°å¸¶äºº"])
  };
  m12["ç­–ç•¥è¦åŠƒ"].hint = "èšç„¦ï¼šç›®æ¨™æ‹†è§£ã€å„ªå…ˆé †åºã€é¢¨éšªæ§ç®¡ã€‚";
  m12["æµç¨‹æ²»ç†"].hint = "èšç„¦ï¼šæµç¨‹è½åœ°ã€ç¯€é»æ§ç®¡ã€è·¨éƒ¨é–€å”åŒã€‚";
  m12["å•†æ¥­æ•æ„Ÿ"].hint = "èšç„¦ï¼šæˆæœ¬/åƒ¹å€¼ã€æ±ºç­–ä¾æ“šã€åˆ©å®³é—œä¿‚äººæºé€šã€‚";
  m12["äººæ‰åŸ¹è‚²"].hint = "èšç„¦ï¼šæˆæ¬Šã€æ•™ç·´å¼ç®¡ç†ã€ç¸¾æ•ˆå›é¥‹èˆ‡æˆé•·ã€‚";
  return m12;
})();

const MODEL_BANKS = { M9: QUESTION_BANK_M9, M12: QUESTION_BANK_M12 };
const MODEL_LABEL = { M9:"M9ï¼ˆè·å ´æ ¸å¿ƒï¼‰", M12:"M12ï¼ˆç®¡ç†/æˆé•·ï¼‰" };

/** ======================================================
 *  State + Storageï¼ˆmodel + topic åˆ†é–‹ï¼‰
 * ====================================================== */
const STORAGE_PREFIX = "m9m12_demo_state_v2__";
const LAST_MODEL_KEY = "m9m12_demo_last_model_v1";
const LAST_BANK_KEY_PREFIX = "m9m12_demo_last_bank_v2__";

let state = {
  model:"M9",
  target:"",
  bankKey:"",
  prefs:{ tone:"direct", focus:"action", role:"individual" },
  qIndex:0,
  answers:{},       // QID -> score|null
  unsureCount:0,
  result:null
};

const $ = (sel)=>document.querySelector(sel);
const $$ = (sel)=>Array.from(document.querySelectorAll(sel));

function bankFor(model){ return MODEL_BANKS[model] || QUESTION_BANK_M9; }
function defaultBankFor(model){
  const keys = Object.keys(bankFor(model));
  return keys[0] || "æºé€šå”ä½œ";
}
function getBank(){ return bankFor(state.model); }
function presetKeys(){ return Object.keys(getBank()); }
function storageKeyFor(model, bankKey){
  return STORAGE_PREFIX + encodeURIComponent(model||"M9") + "__" + encodeURIComponent(bankKey||"default");
}
function lastBankKeyFor(model){
  return LAST_BANK_KEY_PREFIX + (model||"M9");
}
function updateBuildLabel(){
  const el = $("#buildLabel");
  if(!el) return;
  el.textContent = `${BUILD_LABEL_BASE} Â· ${state.model}`;
}
function setClock(){
  const d = new Date();
  const hh = String(d.getHours()).padStart(2,"0");
  const mm = String(d.getMinutes()).padStart(2,"0");
  $("#clock").textContent = `${hh}:${mm}`;
}

function loadDraft(model, bankKey){
  try{
    const raw = localStorage.getItem(storageKeyFor(model, bankKey));
    if(!raw) return null;
    const obj = JSON.parse(raw);
    if(obj && typeof obj==="object") return obj;
  }catch(e){}
  return null;
}

function saveDraft(){
  try{
    localStorage.setItem(storageKeyFor(state.model, state.bankKey), JSON.stringify(state));
    localStorage.setItem(LAST_MODEL_KEY, state.model);
    localStorage.setItem(lastBankKeyFor(state.model), state.bankKey);
  }catch(e){}
}

function clearDraft(model, bankKey){
  try{ localStorage.removeItem(storageKeyFor(model, bankKey)); }catch(e){}
}

function show(viewId){
  $$(".view").forEach(v=>v.classList.remove("active"));
  const el = document.getElementById(viewId);
  if(el) el.classList.add("active");
  updateBuildLabel();
  setClock();
}

function setStateFromDraft(d){
  if(!d) return;

  const nextModel = (d.model && MODEL_BANKS[d.model]) ? d.model : state.model;
  const b = bankFor(nextModel);

  state = {
    model: nextModel,
    target: typeof d.target==="string" ? d.target : "",
    bankKey: (typeof d.bankKey==="string" && b[d.bankKey]) ? d.bankKey : defaultBankFor(nextModel),
    prefs: d.prefs && typeof d.prefs==="object" ? {...state.prefs, ...d.prefs} : state.prefs,
    qIndex: Number.isFinite(d.qIndex) ? d.qIndex : 0,
    answers: d.answers && typeof d.answers==="object" ? d.answers : {},
    unsureCount: Number.isFinite(d.unsureCount) ? d.unsureCount : 0,
    result: d.result && typeof d.result==="object" ? d.result : null
  };
}

function setPrefActive(){
  $$(".chip.pref").forEach(el=>{
    const k = el.dataset.key;
    const v = el.dataset.val;
    el.classList.toggle("active", state.prefs[k] === v);
  });
}

function setModelActive(){
  $$(".chip.model").forEach(el=>{
    el.classList.toggle("active", el.dataset.model === state.model);
  });
}

/** ======================================================
 *  Bank switch / Home
 * ====================================================== */
function renderPresetChips(){
  const box = $("#presetChips");
  box.innerHTML = "";
  presetKeys().forEach(k=>{
    const el = document.createElement("div");
    el.className = "chip";
    el.textContent = k;
    el.onclick = ()=>{
      $("#targetInput").value = k;
      $$("#presetChips .chip").forEach(x=>x.classList.remove("active"));
      el.classList.add("active");
    };
    box.appendChild(el);
  });
}

function resolveBankKey(input){
  const s = (input||"").toString().trim().replace(/\s+/g,"");
  if(!s) return defaultBankFor(state.model);

  // exact / contains
  for(const k of presetKeys()){
    const kk = k.replace(/\s+/g,"");
    if(kk === s) return k;
  }
  for(const k of presetKeys()){
    const kk = k.replace(/\s+/g,"");
    if(s.includes(kk) || kk.includes(s)) return k;
  }
  // fallback
  return defaultBankFor(state.model);
}

function switchBankByInput(inputText){
  const resolved = resolveBankKey(inputText);
  if(!getBank()[resolved]) return;

  // same topic: just update target text
  if(state.bankKey === resolved){
    state.target = inputText || resolved;
    saveDraft();
    return;
  }

  // save current
  if(state.bankKey) saveDraft();

  // load or reset for new topic
  const draft = loadDraft(state.model, resolved);
  if(draft){
    setStateFromDraft(draft);
  }else{
    state.target = resolved;
    state.bankKey = resolved;
    state.qIndex = 0;
    state.answers = {};
    state.unsureCount = 0;
    state.result = null;
  }
  saveDraft();
}

function currentBank(){
  const b = getBank();
  return b[state.bankKey] || b[defaultBankFor(state.model)] || Object.values(b)[0];
}

function currentQuestions(){
  return (currentBank().questions || []).slice(0,8);
}

/** ======================================================
 *  Overview / Quiz / Result
 * ====================================================== */
function answeredCount(){
  const qs = currentQuestions();
  let n=0;
  qs.forEach(q=>{
    if(Object.prototype.hasOwnProperty.call(state.answers, q.id)) n++;
  });
  return n;
}

function renderOverview(){
  const b = currentBank();
  const title = state.bankKey || defaultBankFor(state.model);

  $("#ovTitle").textContent = `ä¸»é¡Œï¼š${title}`;
  $("#ovHint").textContent = b.hint || "â€”";

  const a = answeredCount();
  $("#ovProgress").textContent = `${a}/8`;
  $("#ovBar").style.width = `${Math.round((a/8)*100)}%`;

  $("#ovModel").textContent = `æ¨¡å‹ï¼š${MODEL_LABEL[state.model] || state.model}`;
  $("#ovTone").textContent = `é¢¨æ ¼ï¼š${toneLabel(state.prefs.tone)} / ${focusLabel(state.prefs.focus)} / ${roleLabel(state.prefs.role)}`;
  updateBuildLabel();
}

function renderQuestion(){
  const qs = currentQuestions();
  const idx = Math.max(0, Math.min(state.qIndex, qs.length-1));
  state.qIndex = idx;

  const q = qs[idx];
  $("#qStep").textContent = `${idx+1}/8`;
  $("#qDim").textContent = q.dim || "â€”";
  $("#qId").textContent = q.id || `Q${idx+1}`;
  $("#qTitle").textContent = q.title || "â€”";
  $("#qDesc").textContent = q.desc || "â€”";

  const box = $("#optBox");
  box.innerHTML = "";

  const selected = state.answers[q.id];

  (q.options||[]).forEach(opt=>{
    const el = document.createElement("div");
    el.className = "opt";
    el.textContent = opt.text;
    el.onclick = ()=>{
      state.answers[q.id] = opt.score;
      saveDraft();
      renderQuestion();
    };
    if(selected === opt.score) el.classList.add("selected");
    box.appendChild(el);
  });

  // unsure
  const unsure = document.createElement("div");
  unsure.className = "opt";
  unsure.textContent = "ä¸ç¢ºå®šï¼ˆå…ˆè·³éï¼Œä¹‹å¾Œå†å›ä¾†ï¼‰";
  unsure.onclick = ()=>{
    if(!Object.prototype.hasOwnProperty.call(state.answers, q.id)) state.unsureCount += 1;
    state.answers[q.id] = null;
    saveDraft();
    renderQuestion();
  };
  if(selected === null) unsure.classList.add("selected");
  box.appendChild(unsure);

  $("#btnPrev").disabled = (idx===0);
  $("#btnPrev").style.opacity = (idx===0) ? .55 : 1;
}

function computeResult(){
  const qs = currentQuestions();

  // å¼·åˆ¶å®Œæˆï¼šä¸å…è¨± 0/8 æˆ– æœªæ»¿ 8 é¡Œç›´æ¥ç”Ÿæˆ
  const a = answeredCount();
  if(a < 8){
    alert(`ä½ å°šæœªå®Œæˆç­”é¡Œï¼šç›®å‰ ${a}/8ã€‚\nè«‹å®Œæˆ 8 é¡Œå¾Œå†ç”Ÿæˆçµæœã€‚`);
    show("v-s4");
    renderQuestion();
    return null;
  }

  // average & dim averages
  const dimMap = {};
  let sum=0, cnt=0;
  qs.forEach(q=>{
    const v = state.answers[q.id];
    // v can be null, but since a==8, null is still counted as answered; treat null as 3 (ä¸­ç«‹) butæœƒé™ä½å¯ä¿¡åº¦
    const score = (v===null) ? 3 : v;
    sum += score; cnt += 1;

    const d = q.dim || "ç¶œåˆ";
    if(!dimMap[d]) dimMap[d] = {sum:0, cnt:0};
    dimMap[d].sum += score;
    dimMap[d].cnt += 1;
  });

  const avg = sum / Math.max(1,cnt);
  const stars = clamp(Math.round(avg), 1, 5);

  const dims = Object.keys(dimMap).map(k=>{
    const a = dimMap[k].sum / Math.max(1, dimMap[k].cnt);
    return { dim:k, avg:a, stars: clamp(Math.round(a),1,5) };
  }).sort((a,b)=>b.stars-a.stars);

  const confidence = confidenceLabel(state.unsureCount);

  const r = {
    stars,
    avg,
    dims,
    confidence,
    meta:{
      model: state.model,
      topic: state.bankKey,
      unsureCount: state.unsureCount,
      prefs:{...state.prefs}
    }
  };
  state.result = r;
  saveDraft();
  return r;
}

function renderResult(){
  const r = state.result;
  if(!r) return;

  $("#rsTitle").textContent = `ä½ çš„æ˜Ÿç­‰ï¼š${r.stars}â˜…`;
  $("#rsSub").textContent = `${MODEL_LABEL[r.meta.model] || r.meta.model} Â· ä¸»é¡Œã€Œ${r.meta.topic}ã€ Â· ä¿¡å¿ƒåº¦ï¼š${r.confidence}`;

  const dimsBox = $("#rsDims");
  dimsBox.innerHTML = "";
  r.dims.forEach(d=>{
    const row = document.createElement("div");
    row.className = "row";
    row.style.padding = "8px 0";
    row.style.borderBottom = "1px dashed rgba(230,234,242,.9)";
    row.innerHTML = `
      <div>
        <div class="kpi">${escapeHtml(d.dim)}</div>
        <div class="small">å¹³å‡ï¼š${d.avg.toFixed(1)} / 5</div>
      </div>
      <div class="stars">${renderStars(d.stars)}</div>
    `;
    dimsBox.appendChild(row);
  });
  const meta = `Buildï¼š${BUILD_LABEL_BASE} Â· ä¸ç¢ºå®šæ¬¡æ•¸ï¼š${r.meta.unsureCount}`;
  $("#rsMeta").textContent = meta;
}

function renderReport(){
  const r = state.result;
  if(!r) return;

  $("#rpSub").textContent = `${MODEL_LABEL[r.meta.model] || r.meta.model} Â· ä¸»é¡Œã€Œ${r.meta.topic}ã€ Â· æ˜Ÿç­‰ ${r.stars}â˜… Â· ä¿¡å¿ƒåº¦ï¼š${r.confidence}`;

  const tone = state.prefs.tone;
  const focus = state.prefs.focus;
  const role = state.prefs.role;

  const topDims = r.dims.slice(0,2).map(x=>x.dim);
  const lowDims = r.dims.slice(-2).map(x=>x.dim);

  const blocks = [];
  blocks.push(cardBlock("æ•´é«”åˆ¤è®€", reportOverall(r, tone)));
  blocks.push(cardBlock("ä½ çš„å„ªå‹¢ï¼ˆTop 2ï¼‰", `ç›®å‰è¡¨ç¾è¼ƒå¼·çš„é¢å‘ç‚ºï¼š<b>${escapeHtml(topDims.join("ã€"))}</b>ã€‚å»ºè­°æŠŠå®ƒå€‘ç•¶ä½œæ¨é€²å·¥ä½œçš„ä¸»å¼•æ“ã€‚`));
  blocks.push(cardBlock("å¯å„ªå…ˆè£œå¼·ï¼ˆBottom 2ï¼‰", `è¼ƒéœ€è¦åˆ»æ„ç·´ç¿’çš„é¢å‘ç‚ºï¼š<b>${escapeHtml(lowDims.join("ã€"))}</b>ã€‚å…ˆåšå°å¹…åº¦çš„å¯åŸ·è¡Œæ”¹å‹•ï¼Œé¿å…ä¸€æ¬¡æ”¹å¤ªå¤§ã€‚`));
  blocks.push(cardBlock("ä¸‹ä¸€æ­¥è¡Œå‹•ï¼ˆ3 æ¢ï¼‰", reportActions(r, focus, role)));
  blocks.push(cardBlock("æé†’", reportNotes(r)));

  $("#rpBody").innerHTML = blocks.join("");
}

/** ======================================================
 *  Text helpers
 * ====================================================== */
function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }
function escapeHtml(s){
  return (s||"").toString()
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
function renderStars(n){
  let out="";
  for(let i=1;i<=5;i++){
    out += `<span class="star ${i<=n ? "on":""}">â˜…</span>`;
  }
  return out;
}
function confidenceLabel(unsureCount){
  if(unsureCount<=1) return "é«˜";
  if(unsureCount<=3) return "ä¸­";
  return "ä½";
}
function toneLabel(v){
  return ({direct:"ç›´æ¥æ¸…æ¥š", warm:"æº«å’Œé¼“å‹µ", formal:"å•†å‹™æ­£å¼"}[v] || "é è¨­");
}
function focusLabel(v){
  return ({action:"å¯åŸ·è¡Œå»ºè­°", strategy:"ç­–ç•¥è„ˆçµ¡", coach:"æ•™ç·´å¼•å°"}[v] || "é è¨­");
}
function roleLabel(v){
  return ({individual:"å€‹äººè²¢ç»è€…", lead:"å¸¶äººä¸»ç®¡", owner:"è² è²¬äºº/è€é—†"}[v] || "é è¨­");
}
function cardBlock(title, html){
  return `
    <div style="padding:10px 0;border-bottom:1px dashed rgba(230,234,242,.9)">
      <div class="kpi">${escapeHtml(title)}</div>
      <div class="spacer" style="height:8px"></div>
      <div class="small" style="font-size:13.5px;color:#1F2937;line-height:1.55">${html}</div>
    </div>
  `;
}
function reportOverall(r, tone){
  const base = `æ•´é«”å¹³å‡ç´„ <b>${r.avg.toFixed(1)}</b>/5ï¼Œå±¬æ–¼ <b>${r.stars}â˜…</b> æ°´æº–ã€‚`;
  if(tone==="warm") return base + ` ä½ å·²ç¶“å…·å‚™ä¸éŒ¯çš„åº•ç›¤ï¼Œæ¥ä¸‹ä¾†åªè¦æŠŠå…©å€‹é—œéµé¢å‘å†æ‹‰èµ·ä¾†ï¼Œæ•ˆæœæœƒå¾ˆæ˜é¡¯ã€‚`;
  if(tone==="formal") return base + ` å»ºè­°ä»¥ã€Œå¯é©—æ”¶çš„è¡Œç‚ºè®Šæ›´ã€ç‚ºå°å‘ï¼Œé€æ­¥æé«˜ç©©å®šåº¦èˆ‡å¯é æœŸæ€§ã€‚`;
  return base + ` å»ºè­°æŠŠå¼·é …ç”¨åœ¨ã€Œå¸¶å‹•é€²åº¦ã€ï¼Œå¼±é …ç”¨å°æ­¥è¿­ä»£è£œèµ·ä¾†ã€‚`;
}
function reportActions(r, focus, role){
  const t = r.meta.topic;
  const a1 = `è¨­å®š 1 å€‹ã€Œå¯é©—æ”¶ã€çš„è¡Œç‚ºï¼šä¾‹å¦‚æ¯æ¬¡äº¤ä»˜éƒ½é™„ä¸Š <b>é©—æ”¶æ¨™æº–</b>ï¼ˆèª°ã€ä½•æ™‚ã€ä»€éº¼ç®—å®Œæˆï¼‰ã€‚`;
  const a2 = `æŠŠæœ¬ä¸»é¡Œæ‹†æˆ 2 é€±ç¯€å¥ï¼šæ¯é€±å›ºå®šåš 1 æ¬¡ <b>å›é¡§/å¾©ç›¤</b>ï¼Œåªæ”¹ 1 ä»¶äº‹ã€‚`;
  const a3 = (role==="lead" || role==="owner")
    ? `æŠŠæ”¹å‹•åšæˆåœ˜éšŠè¦å‰‡ï¼šç”¨ <b>æ¨¡æ¿/æ¸…å–®</b> å›ºåŒ–ï¼Œé™ä½é å€‹äººæ’ä½çš„æˆæœ¬ã€‚`
    : `å…ˆå¾ä½ èƒ½æ§åˆ¶çš„ç•Œé¢æ”¹ï¼šç”¨ <b>æ¸…å–®/ç¯„ä¾‹</b> æå‡ä½ çš„äº¤ä»˜ä¸€è‡´æ€§ã€‚`;

  if(focus==="strategy") return `1) ${a1}<br/>2) æŠŠæ”¹å‹•é€£åˆ°ç›®æ¨™ï¼šé€™ä»¶äº‹æœƒæ”¹å–„å“ªå€‹æŒ‡æ¨™ï¼Ÿ<br/>3) ${a3}`;
  if(focus==="coach") return `1) ${a1}<br/>2) æ¯æ¬¡é‡åˆ°å¡é»å…ˆå•è‡ªå·±ï¼š<b>æˆ‘è¦çš„æ˜¯ä»€éº¼çµæœï¼Ÿ</b><br/>3) ${a3}`;
  return `1) ${a1}<br/>2) ${a2}<br/>3) ${a3}`;
}
function reportNotes(r){
  if(r.meta.unsureCount>=4){
    return `ä½ é¸äº†è¼ƒå¤šã€Œä¸ç¢ºå®šã€ï¼Œä»£è¡¨ç›®å‰è©•ä¼°å¯ä¿¡åº¦è¼ƒä½ã€‚å»ºè­°ä¸‹æ¬¡ç­”é¡Œæ™‚ç”¨ã€Œæœ€è¿‘ 2 é€±ã€ä½œç‚ºå›æ†¶ç¯„åœï¼Œæœƒæ›´æº–ã€‚`;
  }
  return `æé†’ï¼šé€™æ˜¯ demo ç‰ˆæœ¬ï¼ˆç¡¬ç·¨é¡Œåº«ï¼‰ï¼Œä¸»è¦ç”¨ä¾†é©—è­‰ UI/UX èˆ‡å•†æ¥­åŒ–äº’å‹•é«”é©—ã€‚`;
}

/** ======================================================
 *  Bind / Flow
 * ====================================================== */
function initFromStorage(){
  // model
  const lastModel = localStorage.getItem(LAST_MODEL_KEY);
  state.model = (lastModel && MODEL_BANKS[lastModel]) ? lastModel : "M9";

  // bank for model
  const lastBank = localStorage.getItem(lastBankKeyFor(state.model));
  const initBank = (lastBank && bankFor(state.model)[lastBank]) ? lastBank : defaultBankFor(state.model);

  // draft
  const draft = loadDraft(state.model, initBank);
  if(draft) setStateFromDraft(draft);
  else{
    state.bankKey = initBank;
    state.target = initBank;
    state.qIndex = 0;
    state.answers = {};
    state.unsureCount = 0;
    state.result = null;
    saveDraft();
  }
}

function bind(){
  // back buttons
  $$(".back[data-back]").forEach(el=>{
    el.onclick = ()=> show(el.dataset.back);
  });

  $("#advRow").onclick = ()=>{
    const v = $("#targetInput").value.trim();
    if(v) state.target = v;
    setPrefActive();
    setModelActive();
    show("v-s2");
  };

  $("#btnToOverview1").onclick = ()=>{
    const v = $("#targetInput").value.trim();
    if(v) switchBankByInput(v);
    renderOverview();
    show("v-s3");
  };

  $("#btnToOverview2").onclick = ()=>{
    const v = $("#targetInput").value.trim();
    if(v) switchBankByInput(v);
    renderOverview();
    show("v-s3");
  };

  // model chips
  $$(".chip.model").forEach(ch=>{
    ch.onclick = ()=>{
      // save current (old model/topic)
      if(state.bankKey) saveDraft();

      const next = ch.dataset.model;
      if(!MODEL_BANKS[next] || next===state.model){
        setModelActive();
        return;
      }

      // switch model
      state.model = next;

      // choose last bank in that model, then load draft or reset
      const lastBank = localStorage.getItem(lastBankKeyFor(state.model));
      const initBank = (lastBank && bankFor(state.model)[lastBank]) ? lastBank : defaultBankFor(state.model);

      const draft = loadDraft(state.model, initBank);
      if(draft) setStateFromDraft(draft);
      else{
        state.bankKey = initBank;
        state.target = initBank;
        state.qIndex = 0;
        state.answers = {};
        state.unsureCount = 0;
        state.result = null;
        saveDraft();
      }

      // update home chips & placeholder
      renderPresetChips();
      $("#targetInput").placeholder = (state.model==="M9")
        ? "ä¾‹å¦‚ï¼šæºé€šå”ä½œ / åŸ·è¡Œæ¨é€² / å•é¡Œè§£æ±º / é ˜å°å¸¶äºº"
        : "ä¾‹å¦‚ï¼šç­–ç•¥è¦åŠƒ / æµç¨‹æ²»ç† / å•†æ¥­æ•æ„Ÿ / äººæ‰åŸ¹è‚²";

      setModelActive();
      renderOverview();
      updateBuildLabel();
    };
  });

  // prefs
  $$(".chip.pref").forEach(ch=>{
    ch.onclick = ()=>{
      const k = ch.dataset.key;
      const v = ch.dataset.val;
      state.prefs[k] = v;
      saveDraft();
      setPrefActive();
      renderOverview();
    };
  });

  $("#btnStartQuiz").onclick = ()=>{
    // go quiz
    const v = $("#targetInput").value.trim();
    if(v) switchBankByInput(v);
    state.result = null;
    saveDraft();
    renderQuestion();
    show("v-s4");
  };

  $("#btnBackToOv").onclick = ()=>{
    renderOverview();
    show("v-s3");
  };

  $("#btnPrev").onclick = ()=>{
    state.qIndex = Math.max(0, state.qIndex-1);
    saveDraft();
    renderQuestion();
  };

  $("#btnNext").onclick = ()=>{
    // require answered current before next (null is allowed as "answered")
    const qs = currentQuestions();
    const q = qs[state.qIndex];
    if(!Object.prototype.hasOwnProperty.call(state.answers, q.id)){
      alert("è«‹å…ˆé¸æ“‡ä¸€å€‹é¸é …ï¼ˆæˆ–é¸ã€ä¸ç¢ºå®šã€ï¼‰å†å¾€ä¸‹ã€‚");
      return;
    }

    if(state.qIndex < 7){
      state.qIndex += 1;
      saveDraft();
      renderQuestion();
      return;
    }

    // last question -> compute result
    const r = computeResult();
    if(!r) return; // blocked if not completed
    renderResult();
    show("v-s5");
  };

  $("#btnResetTopic").onclick = ()=>{
    if(!confirm("è¦æ¸…é™¤æ­¤ä¸»é¡Œè‰ç¨¿ä¸¦å›åˆ°æ¦‚è¦½å—ï¼Ÿ")) return;
    clearDraft(state.model, state.bankKey);
    // reset current
    state.qIndex=0;
    state.answers={};
    state.unsureCount=0;
    state.result=null;
    saveDraft();
    renderOverview();
    show("v-s3");
  };

  $("#btnResetAll").onclick = ()=>{
    if(!confirm("è¦æ¸…é™¤æ‰€æœ‰æ¨¡å‹/ä¸»é¡Œè‰ç¨¿ä¸¦å›åˆ°é¦–é å—ï¼Ÿ")) return;

    // clear all drafts across both models
    ["M9","M12"].forEach(m=>{
      Object.keys(bankFor(m)).forEach(k=> clearDraft(m,k));
      try{ localStorage.removeItem(lastBankKeyFor(m)); }catch(e){}
    });
    try{ localStorage.removeItem(LAST_MODEL_KEY); }catch(e){}

    // reset to defaults
    state = {
      model:"M9",
      target:"",
      bankKey: defaultBankFor("M9"),
      prefs:{ tone:"direct", focus:"action", role:"individual" },
      qIndex:0,
      answers:{},
      unsureCount:0,
      result:null
    };
    $("#targetInput").value = "";
    renderPresetChips();
    saveDraft();
    show("v-s1");
  };

  $("#btnToReport").onclick = ()=>{
    // ç¢ºä¿æœ‰çµæœ
    if(!state.result){
      const r = computeResult();
      if(!r) return;
    }
    renderReport();
    show("v-s6");
  };
}

/** ======================================================
 *  Boot
 * ====================================================== */
document.addEventListener("DOMContentLoaded", ()=>{
  setClock();
  setInterval(setClock, 10_000);

  initFromStorage();

  // init UI
  renderPresetChips();
  $("#targetInput").value = state.bankKey || "";
  setPrefActive();
  setModelActive();
  renderOverview();
  updateBuildLabel();

  bind();
});
</script>
</body>
</html>
